---
title: "Testing_Model_Assumptions"
author: "Rachel"
date: "7/9/2020"
output: html_document
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
```


## 1. Load libraries
```{r message=FALSE, results='hide'}
x<-c("car", "lme4", "ggplot2", "dplyr", "tibble", "stringr", 'fitdistrplus', 'sjPlot', "condformat", 'kableExtra')
lapply(x, require, character.only = TRUE)
```


## 2. Load data
```{r}
GC<-read.csv("GCunmatched.csv", h=T)
NEO<-read.csv("NEOunmatched.csv", h=T)
GC_Behavior<-read.csv("GC_behavior_matched.csv")
TL_NEO<-read.csv("Time-lagged_NEO.csv", h=T)
Concurrent_NEO<-read.csv("Concurrent_NEO.csv", h=T)
```

## 3. Test for normal distribution in response variables
### Response variable: fGC 
```{r}
par(mfrow=c(1,2)) 
hist(GC$final.conc, breaks=100)
hist(log(GC$final.conc),breaks=100)  
```

  **ln transformed fGC more normally distributed**

```{r}
descdist(log(GC$final.conc), boot= 500)
plotdist(log(GC$final.conc), histo=TRUE, demp=TRUE)
```


### Response variable: uNEO
```{r}
par(mfrow=c(1,2)) 
hist(NEO$NEO.CR, breaks=100)
hist((log(NEO$NEO.CR)), breaks=100)
```

  **ln transformed NEO more normally distributed**

```{r}
descdist(log(NEO$NEO.CR), boot= 500)
plotdist(log(NEO$NEO.CR), histo=TRUE, demp=TRUE)
```

```{r echo=FALSE, message=FALSE}
unloadNamespace("fitdistrplus")
library(dplyr)
```


## 4. Check for homoscedascity (residuals vs fitted values)
### Linear models response variable: ln(GC)
```{r}
GC.LM1=lm(log(GC.final.conc)~ FreqAllProx + RelRank, data=GC_Behavior)
GC.LM2=lm(log(GC.final.conc)~ FreqTotalGR  + RelRank, data=GC_Behavior)
GC.LM3=lm(log(GC.final.conc)~ FreqGRRec + RelRank, data=GC_Behavior)
GC.LM4=lm(log(GC.final.conc)~ FreqGRGiven + RelRank, data=GC_Behavior)
GC.LM5=lm(log(GC.final.conc)~ FreqTimeSpentCop + RelRank, data=GC_Behavior)
GC.LM6=lm(log(GC.final.conc)~ FreqTimeSpentConsort + RelRank, data=GC_Behavior)
```

```{r}
par(mfrow = c(2,2))
GC.LM1=lm(log(GC.final.conc)~ FreqAllProx + RelRank, data=GC_Behavior)
plot(GC.LM1)


GC.LM2=lm(log(GC.final.conc)~ FreqTotalGR  + RelRank, data=GC_Behavior)
plot(GC.LM2)

GC.LM3=lm(log(GC.final.conc)~ FreqGRRec + RelRank, data=GC_Behavior)
plot(GC.LM3)

GC.LM4=lm(log(GC.final.conc)~ FreqGRGiven + RelRank, data=GC_Behavior)
plot(GC.LM4)

GC.LM5=lm(log(GC.final.conc)~ FreqTimeSpentCop + RelRank, data=GC_Behavior)
plot(GC.LM5)

GC.LM6=lm(log(GC.final.conc)~ FreqTimeSpentConsort + RelRank, data=GC_Behavior)
plot(GC.LM6)
```

  **points appear evenly disbursed around 0**



### Linear models response variable: time-lagged ln(NEO)
```{r}
NEO.TL.LM1=lm(log(NEO.CR)~ FreqAllProx  + RelRank, data=TL_NEO)
NEO.TL.LM2=lm(log(NEO.CR)~ FreqTotalGR + RelRank, data=TL_NEO)
NEO.TL.LM3=lm(log(NEO.CR)~ FreqGRRec + RelRank, data=TL_NEO)
NEO.TL.LM4=lm(log(NEO.CR)~ FreqGRGiven + RelRank, data=TL_NEO)
NEO.TL.LM5=lm(log(NEO.CR)~ FreqTimeSpentCop + RelRank, data=TL_NEO)
NEO.TL.LM6=lm(log(NEO.CR)~ FreqTimeSpentConsort + RelRank, data=TL_NEO)
```

```{r}
par(mfrow = c(2,2))
NEO.TL.LM1=lm(log(NEO.CR)~ FreqAllProx  + RelRank, data=TL_NEO)
plot(NEO.TL.LM1)

NEO.TL.LM2=lm(log(NEO.CR)~ FreqTotalGR + RelRank, data=TL_NEO)
plot(NEO.TL.LM2)

NEO.TL.LM3=lm(log(NEO.CR)~ FreqGRRec + RelRank, data=TL_NEO)
plot(NEO.TL.LM3)

NEO.TL.LM4=lm(log(NEO.CR)~ FreqGRGiven + RelRank, data=TL_NEO)
plot(NEO.TL.LM4)

NEO.TL.LM5=lm(log(NEO.CR)~ FreqTimeSpentCop + RelRank, data=TL_NEO)
plot(NEO.TL.LM5)

NEO.TL.LM6=lm(log(NEO.CR)~ FreqTimeSpentConsort + RelRank, data=TL_NEO)
plot(NEO.TL.LM6)
```

  **points appear evenly disbursed around 0**



### Linear models response variable: Concurrent ln(NEO)
```{r}
NEO.Con.LM1=lm(log(NEO.CR)~ FreqAllProx  + RelRank, data=Concurrent_NEO)
NEO.Con.LM2=lm(log(NEO.CR)~ FreqTotalGR + RelRank, data=Concurrent_NEO)
NEO.Con.LM3=lm(log(NEO.CR)~ FreqGRRec + RelRank, data=Concurrent_NEO)
NEO.Con.LM4=lm(log(NEO.CR)~ FreqGRGiven + RelRank, data=Concurrent_NEO)
NEO.Con.LM5=lm(log(NEO.CR)~ FreqTimeSpentCop + RelRank, data=Concurrent_NEO)
NEO.Con.LM6=lm(log(NEO.CR)~ FreqTimeSpentConsort + RelRank, data=Concurrent_NEO)
```

```{r}
par(mfrow = c(2,2))
NEO.Con.LM1=lm(log(NEO.CR)~ FreqAllProx  + RelRank, data=Concurrent_NEO)
plot(NEO.Con.LM1)

NEO.Con.LM2=lm(log(NEO.CR)~ FreqTotalGR + RelRank, data=Concurrent_NEO)
plot(NEO.Con.LM2)

NEO.Con.LM3=lm(log(NEO.CR)~ FreqGRRec + RelRank, data=Concurrent_NEO)
plot(NEO.Con.LM3)

NEO.Con.LM4=lm(log(NEO.CR)~ FreqGRGiven + RelRank, data=Concurrent_NEO)
plot(NEO.Con.LM4)

NEO.Con.LM5=lm(log(NEO.CR)~ FreqTimeSpentCop + RelRank, data=Concurrent_NEO)
plot(NEO.Con.LM5)

NEO.Con.LM6=lm(log(NEO.CR)~ FreqTimeSpentConsort + RelRank, data=Concurrent_NEO)
plot(NEO.Con.LM6)
```

  **residuals appear evenly disbursed around 0** 
  
  

## 5. Check for collinearity 
### VIFs for GC models
```{r echo=FALSE}
GC.LM1.vif<-rownames_to_column(as.data.frame(vif(GC.LM1)), "Independent_Variable")
GC.LM1.vif.tidy<- GC.LM1.vif %>%
  rename(VIF = "vif(GC.LM1)") %>%
  add_column(GC_Linear_model = "model 1") %>%
  dplyr::select(GC_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable,'FreqAllProx'))

GC.LM2.vif<-rownames_to_column(as.data.frame(vif(GC.LM2)), "Independent_Variable")
GC.LM2.vif.tidy<- GC.LM2.vif %>%
  rename(VIF = "vif(GC.LM2)") %>%
  add_column(GC_Linear_model = "model 2") %>%
  dplyr::select(GC_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqTotalGR'))

GC.LM3.vif<-rownames_to_column(as.data.frame(vif(GC.LM3)), "Independent_Variable")
GC.LM3.vif.tidy<- GC.LM3.vif %>%
  rename(VIF = "vif(GC.LM3)") %>%
  add_column(GC_Linear_model = "model 3") %>%
  dplyr::select(GC_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqGRRec'))

GC.LM4.vif<-rownames_to_column(as.data.frame(vif(GC.LM4)), "Independent_Variable")
GC.LM4.vif.tidy<- GC.LM4.vif %>%
  rename(VIF = "vif(GC.LM4)") %>%
  add_column(GC_Linear_model = "model 4") %>%
  dplyr::select(GC_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqGRGiven'))

GC.LM5.vif<-rownames_to_column(as.data.frame(vif(GC.LM5)), "Independent_Variable")
GC.LM5.vif.tidy<- GC.LM5.vif %>%
  rename(VIF = "vif(GC.LM5)") %>%
  add_column(GC_Linear_model = "model 5") %>%
  dplyr::select(GC_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqTimeSpentCop'))

GC.LM6.vif<-rownames_to_column(as.data.frame(vif(GC.LM6)), "Independent_Variable")
GC.LM6.vif.tidy<- GC.LM6.vif %>%
  rename(VIF = "vif(GC.LM6)") %>%
  add_column(GC_Linear_model = "model 6") %>%
  dplyr::select(GC_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqTimeSpentConsort'))

All.GC.VIFS <-rbind(GC.LM1.vif.tidy, GC.LM2.vif.tidy, GC.LM3.vif.tidy, GC.LM4.vif.tidy, GC.LM5.vif.tidy, GC.LM6.vif.tidy) %>%
  kable(format="html", escape = F) %>%
  kable_styling(full_width=TRUE); All.GC.VIFS
```

  **All VIFs < 2**
  


### VIFs for Time-lagged NEO models
```{r echo=FALSE}
NEO.TL.LM1.vif<-rownames_to_column(as.data.frame(vif(NEO.TL.LM1)), "Independent_Variable")
NEO.TL.LM1.vif.tidy<- NEO.TL.LM1.vif %>%
  rename(VIF = "vif(NEO.TL.LM1)") %>%
  add_column(NEO.TL_Linear_model = "model 1") %>%
  dplyr::select(NEO.TL_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable,'FreqAllProx'))

NEO.TL.LM2.vif<-rownames_to_column(as.data.frame(vif(NEO.TL.LM2)), "Independent_Variable")
NEO.TL.LM2.vif.tidy<- NEO.TL.LM2.vif %>%
  rename(VIF = "vif(NEO.TL.LM2)") %>%
  add_column(NEO.TL_Linear_model = "model 2") %>%
  dplyr::select(NEO.TL_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqTotalGR'))

NEO.TL.LM3.vif<-rownames_to_column(as.data.frame(vif(NEO.TL.LM3)), "Independent_Variable")
NEO.TL.LM3.vif.tidy<- NEO.TL.LM3.vif %>%
  rename(VIF = "vif(NEO.TL.LM3)") %>%
  add_column(NEO.TL_Linear_model = "model 3") %>%
  dplyr::select(NEO.TL_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqGRRec'))

NEO.TL.LM4.vif<-rownames_to_column(as.data.frame(vif(NEO.TL.LM4)), "Independent_Variable")
NEO.TL.LM4.vif.tidy<- NEO.TL.LM4.vif %>%
  rename(VIF = "vif(NEO.TL.LM4)") %>%
  add_column(NEO.TL_Linear_model = "model 4") %>%
  dplyr::select(NEO.TL_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqGRGiven'))

NEO.TL.LM5.vif<-rownames_to_column(as.data.frame(vif(NEO.TL.LM5)), "Independent_Variable")
NEO.TL.LM5.vif.tidy<- NEO.TL.LM5.vif %>%
  rename(VIF = "vif(NEO.TL.LM5)") %>%
  add_column(NEO.TL_Linear_model = "model 5") %>%
  dplyr::select(NEO.TL_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqTimeSpentCop'))

NEO.TL.LM6.vif<-rownames_to_column(as.data.frame(vif(NEO.TL.LM6)), "Independent_Variable")
NEO.TL.LM6.vif.tidy<- NEO.TL.LM6.vif %>%
  rename(VIF = "vif(NEO.TL.LM6)") %>%
  add_column(NEO.TL_Linear_model = "model 6") %>%
  dplyr::select(NEO.TL_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqTimeSpentConsort'))

All.NEO.TL.VIFS <-rbind(NEO.TL.LM1.vif.tidy, NEO.TL.LM2.vif.tidy, NEO.TL.LM3.vif.tidy, NEO.TL.LM4.vif.tidy, NEO.TL.LM5.vif.tidy, NEO.TL.LM6.vif.tidy) %>%
  kable(format="html", escape = F) %>%
  kable_styling(full_width=TRUE); All.NEO.TL.VIFS
```

  **All VIFs < 2**



### VIFs for Concurrent NEO models
```{r echo=FALSE}
NEO.Con.LM1.vif<-rownames_to_column(as.data.frame(vif(NEO.Con.LM1)), "Independent_Variable")
NEO.Con.LM1.vif.tidy<- NEO.Con.LM1.vif %>%
  rename(VIF = "vif(NEO.Con.LM1)") %>%
  add_column(NEO.Con_Linear_model = "model 1") %>%
  dplyr::select(NEO.Con_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable,'FreqAllProx'))

NEO.Con.LM2.vif<-rownames_to_column(as.data.frame(vif(NEO.Con.LM2)), "Independent_Variable")
NEO.Con.LM2.vif.tidy<- NEO.Con.LM2.vif %>%
  rename(VIF = "vif(NEO.Con.LM2)") %>%
  add_column(NEO.Con_Linear_model = "model 2") %>%
  dplyr::select(NEO.Con_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqTotalGR'))

NEO.Con.LM3.vif<-rownames_to_column(as.data.frame(vif(NEO.Con.LM3)), "Independent_Variable")
NEO.Con.LM3.vif.tidy<- NEO.Con.LM3.vif %>%
  rename(VIF = "vif(NEO.Con.LM3)") %>%
  add_column(NEO.Con_Linear_model = "model 3") %>%
  dplyr::select(NEO.Con_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqGRRec'))

NEO.Con.LM4.vif<-rownames_to_column(as.data.frame(vif(NEO.Con.LM4)), "Independent_Variable")
NEO.Con.LM4.vif.tidy<- NEO.Con.LM4.vif %>%
  rename(VIF = "vif(NEO.Con.LM4)") %>%
  add_column(NEO.Con_Linear_model = "model 4") %>%
  dplyr::select(NEO.Con_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqGRGiven'))

NEO.Con.LM5.vif<-rownames_to_column(as.data.frame(vif(NEO.Con.LM5)), "Independent_Variable")
NEO.Con.LM5.vif.tidy<- NEO.Con.LM5.vif %>%
  rename(VIF = "vif(NEO.Con.LM5)") %>%
  add_column(NEO.Con_Linear_model = "model 5") %>%
  dplyr::select(NEO.Con_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqTimeSpentCop'))

NEO.Con.LM6.vif<-rownames_to_column(as.data.frame(vif(NEO.Con.LM6)), "Independent_Variable")
NEO.Con.LM6.vif.tidy<- NEO.Con.LM6.vif %>%
  rename(VIF = "vif(NEO.Con.LM6)") %>%
  add_column(NEO.Con_Linear_model = "model 6") %>%
  dplyr::select(NEO.Con_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqTimeSpentConsort'))

All.NEO.Con.VIFS <-rbind(NEO.Con.LM1.vif.tidy, NEO.Con.LM2.vif.tidy, NEO.Con.LM3.vif.tidy, NEO.Con.LM4.vif.tidy, NEO.Con.LM5.vif.tidy, NEO.Con.LM6.vif.tidy) %>%
  kable(format="html", escape = F) %>%
  kable_styling(full_width=TRUE); All.NEO.Con.VIFS
```

  **All VIFs < 2**