---
title: "BES_behavioral_immunology"
author: "Rachel"
date: "5/19/2020"
output: html_document
---
```{r global_options, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
```

<style>
div.yellow pre { background-color:lightyellow; }
</style>

## SECTION 1: LOAD LIBRARIES
```{r message=FALSE, results='hide'}
x<-c("car", "lme4", "effects", "ggplot2", "grid", "gridExtra", "dplyr", "tibble", "stringr", "condformat", 'kableExtra', 'crayon', 'fitdistrplus', 'sjPlot', "tidyverse", "ggpubr", "cowplot")
lapply(x, require, character.only = TRUE)
```

## SECTION 2: CHECKING MODEL ASSUMPTIONS
### Load data
```{r}
GC<-read.csv("~/Google Drive/Projects/Masters/R input sheets/GCunmatched.csv", h=T)
NEO<-read.csv("~/Google Drive/Projects/Masters/R input sheets/NEOunmatched.csv", h=T)
GC_Behavior<-read.csv("~/Google Drive/Projects/Masters/R input sheets/GC_behavior_matched.csv")
TL_NEO<-read.csv("~/Google Drive/Projects/Masters/R input sheets/Time-lagged_NEO.csv", h=T)
Concurrent_NEO<-read.csv("~/Google Drive/Projects/Masters/R input sheets/Concurrent_NEO.csv", h=T)
```

## SECTION 3. CHECK VIFS

### Check VIFs for GC models
```{r echo=FALSE}
GC.LM1.vif<-rownames_to_column(as.data.frame(vif(GC.LM1)), "Independent_Variable")
GC.LM1.vif.tidy<- GC.LM1.vif %>%
  rename(VIF = "vif(GC.LM1)") %>%
  add_column(GC_Linear_model = "model 1") %>%
  dplyr::select(GC_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable,'FreqAllProx'))

GC.LM2.vif<-rownames_to_column(as.data.frame(vif(GC.LM2)), "Independent_Variable")
GC.LM2.vif.tidy<- GC.LM2.vif %>%
  rename(VIF = "vif(GC.LM2)") %>%
  add_column(GC_Linear_model = "model 2") %>%
  dplyr::select(GC_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqTotalGR'))

GC.LM3.vif<-rownames_to_column(as.data.frame(vif(GC.LM3)), "Independent_Variable")
GC.LM3.vif.tidy<- GC.LM3.vif %>%
  rename(VIF = "vif(GC.LM3)") %>%
  add_column(GC_Linear_model = "model 3") %>%
  dplyr::select(GC_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqGRRec'))

GC.LM4.vif<-rownames_to_column(as.data.frame(vif(GC.LM4)), "Independent_Variable")
GC.LM4.vif.tidy<- GC.LM4.vif %>%
  rename(VIF = "vif(GC.LM4)") %>%
  add_column(GC_Linear_model = "model 4") %>%
  dplyr::select(GC_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqGRGiven'))

GC.LM5.vif<-rownames_to_column(as.data.frame(vif(GC.LM5)), "Independent_Variable")
GC.LM5.vif.tidy<- GC.LM5.vif %>%
  rename(VIF = "vif(GC.LM5)") %>%
  add_column(GC_Linear_model = "model 5") %>%
  dplyr::select(GC_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqTimeSpentCop'))

GC.LM6.vif<-rownames_to_column(as.data.frame(vif(GC.LM6)), "Independent_Variable")
GC.LM6.vif.tidy<- GC.LM6.vif %>%
  rename(VIF = "vif(GC.LM6)") %>%
  add_column(GC_Linear_model = "model 6") %>%
  dplyr::select(GC_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqTimeSpentConsort'))

All.GC.VIFS <-rbind(GC.LM1.vif.tidy, GC.LM2.vif.tidy, GC.LM3.vif.tidy, GC.LM4.vif.tidy, GC.LM5.vif.tidy, GC.LM6.vif.tidy) %>%
  kable(format="html", escape = F) %>%
  kable_styling(full_width=TRUE); All.GC.VIFS
```

  **All VIFs < 2**


### Check VIFs for Time-lagged NEO models
```{r echo=FALSE}
NEO.TL.LM1.vif<-rownames_to_column(as.data.frame(vif(NEO.TL.LM1)), "Independent_Variable")
NEO.TL.LM1.vif.tidy<- NEO.TL.LM1.vif %>%
  rename(VIF = "vif(NEO.TL.LM1)") %>%
  add_column(NEO.TL_Linear_model = "model 1") %>%
  dplyr::select(NEO.TL_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable,'FreqAllProx'))

NEO.TL.LM2.vif<-rownames_to_column(as.data.frame(vif(NEO.TL.LM2)), "Independent_Variable")
NEO.TL.LM2.vif.tidy<- NEO.TL.LM2.vif %>%
  rename(VIF = "vif(NEO.TL.LM2)") %>%
  add_column(NEO.TL_Linear_model = "model 2") %>%
  dplyr::select(NEO.TL_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqTotalGR'))

NEO.TL.LM3.vif<-rownames_to_column(as.data.frame(vif(NEO.TL.LM3)), "Independent_Variable")
NEO.TL.LM3.vif.tidy<- NEO.TL.LM3.vif %>%
  rename(VIF = "vif(NEO.TL.LM3)") %>%
  add_column(NEO.TL_Linear_model = "model 3") %>%
  dplyr::select(NEO.TL_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqGRRec'))

NEO.TL.LM4.vif<-rownames_to_column(as.data.frame(vif(NEO.TL.LM4)), "Independent_Variable")
NEO.TL.LM4.vif.tidy<- NEO.TL.LM4.vif %>%
  rename(VIF = "vif(NEO.TL.LM4)") %>%
  add_column(NEO.TL_Linear_model = "model 4") %>%
  dplyr::select(NEO.TL_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqGRGiven'))

NEO.TL.LM5.vif<-rownames_to_column(as.data.frame(vif(NEO.TL.LM5)), "Independent_Variable")
NEO.TL.LM5.vif.tidy<- NEO.TL.LM5.vif %>%
  rename(VIF = "vif(NEO.TL.LM5)") %>%
  add_column(NEO.TL_Linear_model = "model 5") %>%
  dplyr::select(NEO.TL_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqTimeSpentCop'))

NEO.TL.LM6.vif<-rownames_to_column(as.data.frame(vif(NEO.TL.LM6)), "Independent_Variable")
NEO.TL.LM6.vif.tidy<- NEO.TL.LM6.vif %>%
  rename(VIF = "vif(NEO.TL.LM6)") %>%
  add_column(NEO.TL_Linear_model = "model 6") %>%
  dplyr::select(NEO.TL_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqTimeSpentConsort'))

All.NEO.TL.VIFS <-rbind(NEO.TL.LM1.vif.tidy, NEO.TL.LM2.vif.tidy, NEO.TL.LM3.vif.tidy, NEO.TL.LM4.vif.tidy, NEO.TL.LM5.vif.tidy, NEO.TL.LM6.vif.tidy) %>%
  kable(format="html", escape = F) %>%
  kable_styling(full_width=TRUE); All.NEO.TL.VIFS
```

  **All VIFs < 2**

### Check VIFs for Concurrent NEO models
```{r echo=FALSE}
NEO.Con.LM1.vif<-rownames_to_column(as.data.frame(vif(NEO.Con.LM1)), "Independent_Variable")
NEO.Con.LM1.vif.tidy<- NEO.Con.LM1.vif %>%
  rename(VIF = "vif(NEO.Con.LM1)") %>%
  add_column(NEO.Con_Linear_model = "model 1") %>%
  dplyr::select(NEO.Con_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable,'FreqAllProx'))

NEO.Con.LM2.vif<-rownames_to_column(as.data.frame(vif(NEO.Con.LM2)), "Independent_Variable")
NEO.Con.LM2.vif.tidy<- NEO.Con.LM2.vif %>%
  rename(VIF = "vif(NEO.Con.LM2)") %>%
  add_column(NEO.Con_Linear_model = "model 2") %>%
  dplyr::select(NEO.Con_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqTotalGR'))

NEO.Con.LM3.vif<-rownames_to_column(as.data.frame(vif(NEO.Con.LM3)), "Independent_Variable")
NEO.Con.LM3.vif.tidy<- NEO.Con.LM3.vif %>%
  rename(VIF = "vif(NEO.Con.LM3)") %>%
  add_column(NEO.Con_Linear_model = "model 3") %>%
  dplyr::select(NEO.Con_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqGRRec'))

NEO.Con.LM4.vif<-rownames_to_column(as.data.frame(vif(NEO.Con.LM4)), "Independent_Variable")
NEO.Con.LM4.vif.tidy<- NEO.Con.LM4.vif %>%
  rename(VIF = "vif(NEO.Con.LM4)") %>%
  add_column(NEO.Con_Linear_model = "model 4") %>%
  dplyr::select(NEO.Con_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqGRGiven'))

NEO.Con.LM5.vif<-rownames_to_column(as.data.frame(vif(NEO.Con.LM5)), "Independent_Variable")
NEO.Con.LM5.vif.tidy<- NEO.Con.LM5.vif %>%
  rename(VIF = "vif(NEO.Con.LM5)") %>%
  add_column(NEO.Con_Linear_model = "model 5") %>%
  dplyr::select(NEO.Con_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqTimeSpentCop'))

NEO.Con.LM6.vif<-rownames_to_column(as.data.frame(vif(NEO.Con.LM6)), "Independent_Variable")
NEO.Con.LM6.vif.tidy<- NEO.Con.LM6.vif %>%
  rename(VIF = "vif(NEO.Con.LM6)") %>%
  add_column(NEO.Con_Linear_model = "model 6") %>%
  dplyr::select(NEO.Con_Linear_model, Independent_Variable, VIF) %>%
  filter(str_detect(Independent_Variable, 'FreqTimeSpentConsort'))

All.NEO.Con.VIFS <-rbind(NEO.Con.LM1.vif.tidy, NEO.Con.LM2.vif.tidy, NEO.Con.LM3.vif.tidy, NEO.Con.LM4.vif.tidy, NEO.Con.LM5.vif.tidy, NEO.Con.LM6.vif.tidy) %>%
  kable(format="html", escape = F) %>%
  kable_styling(full_width=TRUE); All.NEO.Con.VIFS
```

  **All VIFs < 2**


## SECTION2.5: CREATININE
```{r}
Creatinine <- read.csv("~/Google Drive/Projects/Masters/rhesus-sociality-fGC-uNEO/Creatinine.csv")

View(Creatinine)
Creatinine$Date<- mdy(Creatinine$Date)

Creatinine <- Creatinine %>%
  filter(Date > "2015-01-01") %>%
  mutate(DaysSince = Date - "2015-01-01")

mod1 <- lmer(log(CR) ~ Date + (1|Focal.ID), data= Creatinine)

plot(mod1)

plot(fitted(mod1) ~ resid(mod1))

summary(mod1)
anova(mod1, type="III")
```

## SECTION 2.6 Number of minutes followed per day
```{r}
BehaviorOnly <- read.csv("~/Google Drive/Projects/Masters/R input sheets/RhesusFullBehavior.csv")
#View(BehaviorOnly)

BehaviorOnly$TotalKnownDuration <- chron(times= BehaviorOnly$TotalKnownDuration, format= "h:m:s")

MeanDurations <- BehaviorOnly %>%
  summarise(mean_duration = mean(TotalKnownDuration), sd_duration = sd(TotalKnownDuration))


MeanDurations$sd_duration <- chron(times= MeanDurations$sd_duration, format= "h:m:s")

View(MeanDurations)
```

## SECTION 2.7 IOR
```{r}
GroomingIOR <- read.csv("~/Google Drive/Projects/Masters/R input sheets/GroomingIOR.csv")

ScanIOR <- read.csv("~/Google Drive/Projects/Masters/R input sheets/ScanIOR.csv")
```

```{r}
View(GroomingIOR)
View(ScanIOR)
```

```{r}
GroomingIOR$LR <- chron(times= GroomingIOR$LR, format= "h:m:s")
GroomingIOR$CR <- chron(times= GroomingIOR$CR, format= "h:m:s")
```


```{r}
TotalGrIOR <- GroomingIOR %>%
  filter(Measure == "TotalGr")

cor.test(TotalGrIOR$CR, TotalGrIOR$LR)
```

```{r}
RecGrIOR <- GroomingIOR %>%
  filter(Measure == "RecGr")

cor.test(RecGrIOR$CR, RecGrIOR$LR)
```

```{r}
GiveGrIOR <- GroomingIOR %>%
  filter(Measure == "GiveGr")

cor.test(GiveGrIOR$CR, GiveGrIOR$LR)
```

```{r}
cor.test(ScanIOR$CR, ScanIOR$LR)
```


## SECTION 3: LMM ANALYSES
### Load the data
```{r}
GC_Behavior=read.csv("~/Google Drive/Projects/Masters/R input sheets/GC_behavior_matched.csv", h=T) 
TL_NEO<-read.csv("~/Google Drive/Projects/Masters/R input sheets/Time-lagged_NEO.csv", h=T)
Concurrent_NEO<-read.csv("~/Google Drive/Projects/Masters/R input sheets/Concurrent_NEO.csv", h=T)
```

```{r}
View(GC_Behavior) #163 entires
```

```{r}
GC_Behavior_2DateDiff <- GC_Behavior %>%
  filter(DateDiff == "2")
```

```{r}
View(GC_Behavior_2DateDiff) #34 entries
```

```{r}
GC_Behavior_12DateDiff <- GC_Behavior %>%
  filter(DateDiff == "2" | DateDiff =="1")
```

```{r}
View(GC_Behavior_12DateDiff) #65 entries
```

```{r}
View(TL_NEO) #213 entries
```

```{r}
TL_NEO_15DateDiff <- TL_NEO %>%
  filter(DateDiff == "15")
```

```{r}
View(TL_NEO_15DateDiff) #100 entries
```

```{r}
TL_NEO_141516DateDiff <- TL_NEO %>%
  filter(DateDiff == "15" | DateDiff == "14" | DateDiff == "16")
```

```{r}
View(TL_NEO_141516DateDiff) #194 entries
```

```{r}
View(Concurrent_NEO) #267 entries
```

```{r}
Concurrent_NEO_0DateDiff <- Concurrent_NEO %>%
  filter(DateDiff == "0")
```

```{r}
View(Concurrent_NEO_0DateDiff) #223 entries
```

### GC LMMs
```{r}
GC_Behavior$Behav_Date<- mdy(GC_Behavior$Behav_Date)

GC.LMM1=lmer(log(GC.final.conc)~ FreqAllProx + RelRank + (1|ID) + (1|), data=GC_Behavior)
GC.LMM1.red=lmer(log(GC.final.conc)~ RelRank + (1|ID) + (1|Month), data=GC_Behavior)

plot(fitted(GC.LMM1), resid(GC.LMM1))
simulationOutput <- simulateResiduals(fittedModel = GC.LMM1, plot= T)

```


```{r}
GC.LMM1.2day=lmer(log(GC.final.conc)~ FreqAllProx + RelRank + (1|ID) + (1|Month), data=GC_Behavior_2DateDiff)

plot(fitted(GC.LMM1.2day), resid(GC.LMM1.2day))
simulationOutput <- simulateResiduals(fittedModel = GC.LMM1.2day, plot= T)
testDispersion(GC.LMM1.2day)
testZeroInflation(GC.LMM1.2day)


GC.LMM2=lmer(log(GC.final.conc)~ FreqTotalGR + RelRank + (1|ID) +(1|Month), data=GC_Behavior)
GC.LMM3=lmer(log(GC.final.conc)~ FreqGRRec + RelRank + (1|ID) +(1|Month), data=GC_Behavior)
GC.LMM4=lmer(log(GC.final.conc)~ FreqGRGiven + RelRank + (1|ID) +(1|Month), data=GC_Behavior)
GC.LMM5=lmer(log(GC.final.conc)~ FreqTimeSpentCop + RelRank + (1|ID) +(1|Month), data=GC_Behavior)
GC.LMM6=lmer(log(GC.final.conc)~ FreqTimeSpentConsort + RelRank + (1|ID) +(1|Month), data=GC_Behavior)
```

### GC LMM summaries
#### Fixed Effect variable: FreqAllProx
```{r echo=FALSE}
GC.LMM1=lmer(log(GC.final.conc)~ FreqAllProx + RelRank + (1|ID) + (1|Month), data=GC_Behavior)
summary(GC.LMM1)
AnovaGC.LMM1 <-Anova(GC.LMM1, type="III"); AnovaGC.LMM1
```

<div class = "yellow">
```{r echo=FALSE, class.source="yellow"}
cat("p=", AnovaGC.LMM1[2,3], ifelse(AnovaGC.LMM1[2,3]<0.05, red("**SIGNIFICANT**"), "non-significant"))
```
</div>

#### Fixed Effect variable: FreqTotalGR
```{r echo=FALSE}
GC.LMM2=lmer(log(GC.final.conc)~ FreqTotalGR + RelRank + (1|ID) +(1|Month), data=GC_Behavior)
summary(GC.LMM2)
AnovaGC.LMM2 <- Anova(GC.LMM2, type="III"); AnovaGC.LMM2
```

<div class = "yellow">
```{r echo=FALSE}
cat("p=", AnovaGC.LMM2[2,3], ifelse(AnovaGC.LMM2[2,3]<0.05, red("**SIGNIFICANT**"), "non-significant"))
```
</div>

#### Fixed Effect variable: FreqGRRec
```{r echo=FALSE}
GC.LMM3=lmer(log(GC.final.conc)~ FreqGRRec + RelRank + (1|ID) +(1|Month), data=GC_Behavior)
summary(GC.LMM3)
AnovaGC.LMM3 <-Anova(GC.LMM3, type="III"); AnovaGC.LMM3
```

<div class = "yellow">
```{r echo=FALSE}
cat("p=", AnovaGC.LMM3[2,3], ifelse(AnovaGC.LMM3[2,3]<0.05, "**SIGNIFICANT**", "non-significant"))
```
</div>

#### Fixed Effect variable: FreqGRGiven
```{r}
GC.LMM4=lmer(log(GC.final.conc)~ FreqGRGiven + RelRank + (1|ID) +(1|Month), data=GC_Behavior)
summary(GC.LMM4)
AnovaGC.LMM4 <- Anova(GC.LMM4, type="III"); AnovaGC.LMM4
```

<div class = "yellow">
```{r echo=FALSE}
cat("p=", AnovaGC.LMM4[2,3], ifelse(AnovaGC.LMM4[2,3]<0.05, red("**SIGNIFICANT**"), "non-significant"))
```
</div>

#### Fixed Effect variable: FreqTimeSpentCop
```{r}
GC.LMM5=lmer(log(GC.final.conc)~ FreqTimeSpentCop + RelRank + (1|ID) +(1|Month), data=GC_Behavior)
summary(GC.LMM5)
AnovaGC.LMM5<- Anova(GC.LMM5, type="III"); AnovaGC.LMM5
```

<div class = "yellow">
```{r echo=FALSE}
cat("p=", AnovaGC.LMM5[2,3], ifelse(AnovaGC.LMM5[2,3]<0.05, red("**SIGNIFICANT**"), "non-significant"))
```
</div>

#### Fixed Effect variable: FreqTimeSpentConsort
```{r}
GC.LMM6=lmer(log(GC.final.conc)~ FreqTimeSpentConsort + RelRank + (1|ID) +(1|Month), data=GC_Behavior)
summary(GC.LMM6)
AnovaGC.LMM6<- Anova(GC.LMM6, type="III"); AnovaGC.LMM6
```

<div class = "yellow">
```{r echo=FALSE}
cat("p=", AnovaGC.LMM6[2,3], ifelse(AnovaGC.LMM6[2,3]<0.05, red("**SIGNIFICANT**"), "non-significant")) 
```
</div>

### Summary of Wald Chi-square p-values for Fixed Effects
```{r echo=FALSE}
GC.LMM.All.summary <-data.frame(Response_variable = "fGC", Fixed_Effect = c("FreqAllProx", "FreqTotalGr", "FreqGRRec", "FreqGRGiven", "FreqTimeSpentCop", "FreqTimeSpentConsort"), "Estimate" = c(summary(GC.LMM1)$coef[2,"Estimate"], summary(GC.LMM2)$coef[2,"Estimate"], summary(GC.LMM3)$coef[2,"Estimate"], summary(GC.LMM4)$coef[2,"Estimate"], summary(GC.LMM5)$coef[2,"Estimate"], summary(GC.LMM6)$coef[2,"Estimate"]), Std_Error= c(summary(GC.LMM1)$coef[2, "Std. Error"], summary(GC.LMM2)$coef[2, "Std. Error"], summary(GC.LMM3)$coef[2, "Std. Error"], summary(GC.LMM4)$coef[2, "Std. Error"], summary(GC.LMM5)$coef[2, "Std. Error"], summary(GC.LMM6)$coef[2, "Std. Error"]), t_value= c(summary(GC.LMM1)$coef[2, "t value"], summary(GC.LMM2)$coef[2, "t value"], summary(GC.LMM3)$coef[2, "t value"], summary(GC.LMM4)$coef[2, "t value"], summary(GC.LMM5)$coef[2, "t value"], summary(GC.LMM6)$coef[2, "t value"]), Walds_Chi_square= c(AnovaGC.LMM1[2,1], AnovaGC.LMM2[2,1], AnovaGC.LMM3[2,1], AnovaGC.LMM4[2,1], AnovaGC.LMM5[2,1], AnovaGC.LMM6[2,1]), P_value = c(AnovaGC.LMM1[2,3], AnovaGC.LMM2[2,3], AnovaGC.LMM3[2,3], AnovaGC.LMM4[2,3], AnovaGC.LMM5[2,3], AnovaGC.LMM6[2,3]))

GC.LMM.All.summary <- GC.LMM.All.summary %>%
  mutate_if(is.numeric, round, 3) %>%
  mutate(P_value = cell_spec(P_value, "html", bold = ifelse(P_value > 0.05, FALSE, TRUE), color = ifelse(P_value > 0.05, "black", "red"))) %>%
  rename("P-value" = P_value, "Wald's χ2" = Walds_Chi_square, "t-value" = t_value, "Std. Error"= Std_Error, "Fixed Effect"= Fixed_Effect, "Response Variable"= Response_variable) %>%
  kable(format="html", escape = F) %>%
  kable_styling(full_width=TRUE) %>%
  column_spec(7, background = "lightyellow"); GC.LMM.All.summary
```

### GC Proximity drop1 analysis
```{r}
library(lmerTest)
GC.LMM.Prox.drop1model=lmer(log(GC.final.conc)~ FreqJuvProx + FreqAMProx + FreqAFProx + RelRank +  (1|ID) + (1|Month), data=GC_Behavior)
```


```{r echo= FALSE}
GC.LMM.Prox.drop1test <- as.data.frame(drop1(GC.LMM.Prox.drop1model, test= "Chi"))

GC.LMM.Prox.drop1test.tidy <- GC.LMM.Prox.drop1test %>%
  rownames_to_column(var= "Fixed Effect") %>%
  rename("P_value" = "Pr(>F)") %>%
  mutate_if(is.numeric, round, 3) %>%
  mutate("P_value" = cell_spec(P_value, "html", color = ifelse(P_value > 0.05, "black", "red"))) %>%
  kable(format="html", escape = F) %>%
  column_spec(7, background = "lightyellow") %>%
  kable_styling(full_width=TRUE); GC.LMM.Prox.drop1test.tidy

detach("package:lmerTest", unload=TRUE)
```

### Time-lagged NEO LMMs
```{r}
NEO.TL.LMM1=lmer(log(NEO.CR)~ FreqAllProx  + RelRank + (1|ID) +(1|Month), data=TL_NEO)
NEO.TL.LMM2=lmer(log(NEO.CR)~ FreqTotalGR + RelRank +  (1|ID) +(1|Month), data=TL_NEO)
NEO.TL.LMM3=lmer(log(NEO.CR)~ FreqGRRec + RelRank + (1|ID) +(1|Month), data=TL_NEO)
NEO.TL.LMM4=lmer(log(NEO.CR)~ FreqGRGiven + RelRank + (1|ID) +(1|Month), data=TL_NEO)
NEO.TL.LMM5=lmer(log(NEO.CR)~ FreqTimeSpentCop + RelRank + (1|ID) + (1|Month), data=TL_NEO)
NEO.TL.LMM6=lmer(log(NEO.CR)~ FreqTimeSpentConsort + RelRank + (1|ID) +(1|Month), data=TL_NEO)
```

### Time-lagged NEO LMM summaries
#### Fixed Effect variable: FreqAllProx
```{r echo=FALSE}
NEO.TL.LMM1=lmer(log(NEO.CR)~ FreqAllProx + RelRank + (1|ID) + (1|Month), data=TL_NEO)
summary(NEO.TL.LMM1)
AnovaNEO.TL.LMM1 <-Anova(NEO.TL.LMM1, type="III"); AnovaNEO.TL.LMM1
```

<div class = "yellow">
```{r echo=FALSE, class.source="yellow"}
cat("p=", AnovaNEO.TL.LMM1[2,3], ifelse(AnovaNEO.TL.LMM1[2,3]<0.05, red("**SIGNIFICANT**"), "non-significant"))
```
</div>

#### Fixed Effect variable: FreqTotalGR
```{r echo=FALSE}
NEO.TL.LMM2=lmer(log(NEO.CR)~ FreqTotalGR + RelRank + (1|ID) +(1|Month), data=TL_NEO)
summary(NEO.TL.LMM2)
AnovaNEO.TL.LMM2 <- Anova(NEO.TL.LMM2, type="III"); AnovaNEO.TL.LMM2
```

<div class = "yellow">
```{r echo=FALSE}
cat("p=", AnovaNEO.TL.LMM2[2,3], ifelse(AnovaNEO.TL.LMM2[2,3]<0.05, red("**SIGNIFICANT**"), "non-significant"))
```
</div>

#### Fixed Effect variable: FreqGRRec
```{r echo=FALSE}
NEO.TL.LMM3=lmer(log(NEO.CR)~ FreqGRRec + RelRank + (1|ID) +(1|Month), data=TL_NEO)
summary(NEO.TL.LMM3)
AnovaNEO.TL.LMM3 <-Anova(NEO.TL.LMM3, type="III"); AnovaNEO.TL.LMM3
```

<div class = "yellow">
```{r echo=FALSE}
cat("p=", AnovaNEO.TL.LMM3[2,3], ifelse(AnovaNEO.TL.LMM3[2,3]<0.05, "**SIGNIFICANT**", "non-significant"))
```
</div>

#### Fixed Effect variable: FreqGRGiven
```{r}
NEO.TL.LMM4=lmer(log(NEO.CR)~ FreqGRGiven + RelRank + (1|ID) +(1|Month), data=TL_NEO)
summary(NEO.TL.LMM4)
AnovaNEO.TL.LMM4 <- Anova(NEO.TL.LMM4, type="III"); AnovaNEO.TL.LMM4
```

<div class = "yellow">
```{r echo=FALSE}
cat("p=", AnovaNEO.TL.LMM4[2,3], ifelse(AnovaNEO.TL.LMM4[2,3]<0.05, red("**SIGNIFICANT**"), "non-significant"))
```
</div>

#### Fixed Effect variable: FreqTimeSpentCop
```{r}
NEO.TL.LMM5=lmer(log(NEO.CR)~ FreqTimeSpentCop + RelRank + (1|ID) +(1|Month), data=TL_NEO)
summary(NEO.TL.LMM5)
AnovaNEO.TL.LMM5<- Anova(NEO.TL.LMM5, type="III"); AnovaNEO.TL.LMM5
```

<div class = "yellow">
```{r echo=FALSE}
cat("p=", AnovaNEO.TL.LMM5[2,3], ifelse(AnovaNEO.TL.LMM5[2,3]<0.05, red("**SIGNIFICANT**"), "non-significant"))
```
</div>

#### Fixed Effect variable: FreqTimeSpentConsort
```{r}
NEO.TL.LMM6=lmer(log(NEO.CR)~ FreqTimeSpentConsort + RelRank + (1|ID) +(1|Month), data=TL_NEO)
summary(NEO.TL.LMM6)
AnovaNEO.TL.LMM6<- Anova(NEO.TL.LMM6, type="III"); AnovaNEO.TL.LMM6
```

<div class = "yellow">
```{r echo=FALSE}
cat("p=", AnovaNEO.TL.LMM6[2,3], ifelse(AnovaNEO.TL.LMM6[2,3]<0.05, red("**SIGNIFICANT**"), "non-significant")) 
```
</div>

### Summary of Wald Chi-square p-values for Fixed Effects
```{r echo=FALSE}
NEO.TL.LMM.All.summary <-data.frame(Response_variable = "Timelagged uNEO", Fixed_Effect = c("FreqAllProx", "FreqTotalGr", "FreqGRRec", "FreqGRGiven", "FreqTimeSpentCop", "FreqTimeSpentConsort"), "Estimate" = c(summary(NEO.TL.LMM1)$coef[2,"Estimate"], summary(NEO.TL.LMM2)$coef[2,"Estimate"], summary(NEO.TL.LMM3)$coef[2,"Estimate"], summary(NEO.TL.LMM4)$coef[2,"Estimate"], summary(NEO.TL.LMM5)$coef[2,"Estimate"], summary(NEO.TL.LMM6)$coef[2,"Estimate"]), P_value = c(AnovaNEO.TL.LMM1[2,3], AnovaNEO.TL.LMM2[2,3], AnovaNEO.TL.LMM3[2,3], AnovaNEO.TL.LMM4[2,3], AnovaNEO.TL.LMM5[2,3], AnovaNEO.TL.LMM6[2,3]))

NEO.TL.LMM.All.summary <- NEO.TL.LMM.All.summary %>%
  mutate_if(is.numeric, round, 3) %>%
  mutate("P_value" = cell_spec(P_value, "html", color = ifelse(P_value > 0.05, "black", "red"))) %>%
  kable(format="html", escape = F) %>%
  kable_styling(full_width=TRUE) %>%
  column_spec(4, background = "lightyellow"); NEO.TL.LMM.All.summary
```

### Time-lagged NEO Total grooming drop1 analysis
```{r echo=FALSE}
library(lmerTest)
```

```{r}
NEO.TL.LMM.TotalGr.drop1model=lmer(log(NEO.CR)~ FreqTotalGrJuv + FreqTotalGrAM + FreqGRAF + RelRank +  (1|ID) + (1|Month), data=TL_NEO, REML=FALSE)
```


```{r echo=FALSE}
NEO.TL.LMM.TotalGr.drop1test <- as.data.frame(drop1(NEO.TL.LMM.TotalGr.drop1model, test= "Chi"))

NEO.TL.LMM.TotalGr.drop1test.tidy <- NEO.TL.LMM.TotalGr.drop1test %>%
  rownames_to_column(var= "Fixed Effect") %>%
  rename("P_value" = "Pr(>F)") %>%
  mutate_if(is.numeric, round, 3) %>%
  mutate("P_value" = cell_spec(P_value, "html", color = ifelse(P_value > 0.05, "black", "red"))) %>%
  kable(format="html", escape = F) %>%
  column_spec(7, background = "lightyellow") %>%
  kable_styling(full_width=TRUE); NEO.TL.LMM.TotalGr.drop1test.tidy
```

```{r echo=FALSE}
detach("package:lmerTest", unload=TRUE)
```

### Time-lagged NEO Receiving grooming drop1 analysis
```{r echo=FALSE}
library(lmerTest)
```

```{r}
NEO.TL.LMM.RecGr.drop1model=lmer(log(NEO.CR)~ FreqGrRecJuv + FreqGrRecAM + FreqGrRecAF + RelRank + (1|ID) + (1|Month), data=TL_NEO, REML=FALSE)
```

```{r echo=FALSE}
NEO.TL.LMM.RecGr.drop1test <- as.data.frame(drop1(NEO.TL.LMM.RecGr.drop1model, test= "Chi"))

NEO.TL.LMM.RecGr.drop1test.tidy <- NEO.TL.LMM.RecGr.drop1test %>%
  rownames_to_column(var= "Fixed Effect") %>%
  rename("P_value" = "Pr(>F)") %>%
  mutate_if(is.numeric, round, 3) %>%
  mutate("P_value" = cell_spec(P_value, "html", color = ifelse(P_value > 0.05, "black", "red"))) %>%
  kable(format="html", escape = F) %>%
  column_spec(7, background = "lightyellow") %>%
  kable_styling(full_width=TRUE); NEO.TL.LMM.RecGr.drop1test.tidy
```

```{r echo=FALSE}
detach("package:lmerTest", unload=TRUE)
```

### Concurrent NEO LMMs
```{r}
NEO.Con.LMM1=lmer(log(NEO.CR)~ FreqAllProx  + RelRank + (1|ID) + (1|Month), data=Concurrent_NEO)
NEO.Con.LMM2=lmer(log(NEO.CR)~ FreqTotalGR + RelRank +  (1|ID) +(1|Month), data=Concurrent_NEO)
NEO.Con.LMM3=lmer(log(NEO.CR)~ FreqGRRec + RelRank + (1|ID) +(1|Month), data=Concurrent_NEO)
NEO.Con.LMM4=lmer(log(NEO.CR)~ FreqGRGiven + RelRank + (1|ID) +(1|Month), data=Concurrent_NEO)
NEO.Con.LMM5=lmer(log(NEO.CR)~ FreqTimeSpentCop + RelRank + (1|ID) +(1|Month), data=Concurrent_NEO)
NEO.Con.LMM6=lmer(log(NEO.CR)~ FreqTimeSpentConsort + RelRank + (1|ID) +(1|Month), data=Concurrent_NEO)
```

### Concurrent NEO LMM summaries
#### Fixed Effect variable: FreqAllProx
```{r echo=FALSE}
NEO.Con.LMM1=lmer(log(NEO.CR)~ FreqAllProx + RelRank + (1|ID) + (1|Month), data=Concurrent_NEO)
summary(NEO.Con.LMM1)
AnovaNEO.Con.LMM1 <-Anova(NEO.Con.LMM1, type="III"); AnovaNEO.Con.LMM1
```

<div class = "yellow">
```{r echo=FALSE, class.source="yellow"}
cat("p=", AnovaNEO.Con.LMM1[2,3], ifelse(AnovaNEO.Con.LMM1[2,3]<0.05, red("**SIGNIFICANT**"), "non-significant"))
```
</div>

#### Fixed Effect variable: FreqTotalGR
```{r echo=FALSE}
NEO.Con.LMM2=lmer(log(NEO.CR)~ FreqTotalGR + RelRank + (1|ID) +(1|Month), data=Concurrent_NEO)
summary(NEO.Con.LMM2)
AnovaNEO.Con.LMM2 <- Anova(NEO.Con.LMM2, type="III"); AnovaNEO.Con.LMM2
```

<div class = "yellow">
```{r echo=FALSE}
cat("p=", AnovaNEO.Con.LMM2[2,3], ifelse(AnovaNEO.Con.LMM2[2,3]<0.05, red("**SIGNIFICANT**"), "non-significant"))
```
</div>

#### Fixed Effect variable: FreqGRRec
```{r echo=FALSE}
NEO.Con.LMM3=lmer(log(NEO.CR)~ FreqGRRec + RelRank + (1|ID) +(1|Month), data=Concurrent_NEO)
summary(NEO.Con.LMM3)
AnovaNEO.Con.LMM3 <-Anova(NEO.Con.LMM3, type="III"); AnovaNEO.Con.LMM3
```

<div class = "yellow">
```{r echo=FALSE}
cat("p=", AnovaNEO.Con.LMM3[2,3], ifelse(AnovaNEO.Con.LMM3[2,3]<0.05, "**SIGNIFICANT**", "non-significant"))
```
</div>

#### Fixed Effect variable: FreqGRGiven
```{r}
NEO.Con.LMM4=lmer(log(NEO.CR)~ FreqGRGiven + RelRank + (1|ID) +(1|Month), data=Concurrent_NEO)
summary(NEO.Con.LMM4)
AnovaNEO.Con.LMM4 <- Anova(NEO.Con.LMM4, type="III"); AnovaNEO.Con.LMM4
```

<div class = "yellow">
```{r echo=FALSE}
cat("p=", AnovaNEO.Con.LMM4[2,3], ifelse(AnovaNEO.Con.LMM4[2,3]<0.05, red("**SIGNIFICANT**"), "non-significant"))
```
</div>

#### Fixed Effect variable: FreqTimeSpentCop
```{r}
NEO.Con.LMM5=lmer(log(NEO.CR)~ FreqTimeSpentCop + RelRank + (1|ID) +(1|Month), data=Concurrent_NEO)
summary(NEO.Con.LMM5)
AnovaNEO.Con.LMM5<- Anova(NEO.Con.LMM5, type="III"); AnovaNEO.Con.LMM5
```

<div class = "yellow">
```{r echo=FALSE}
cat("p=", AnovaNEO.Con.LMM5[2,3], ifelse(AnovaNEO.Con.LMM5[2,3]<0.05, red("**SIGNIFICANT**"), "non-significant"))
```
</div>

#### Fixed Effect variable: FreqTimeSpentConsort
```{r}
NEO.Con.LMM6=lmer(log(NEO.CR)~ FreqTimeSpentConsort + RelRank + (1|ID) +(1|Month), data=Concurrent_NEO)
summary(NEO.Con.LMM6)
AnovaNEO.Con.LMM6<- Anova(NEO.Con.LMM6, type="III"); AnovaNEO.Con.LMM6
```

<div class = "yellow">
```{r echo=FALSE}
cat("p=", AnovaNEO.Con.LMM6[2,3], ifelse(AnovaNEO.Con.LMM6[2,3]<0.05, red("**SIGNIFICANT**"), "non-significant")) 
```
</div>

### Summary of Wald Chi-square p-values for Fixed Effects
```{r echo=FALSE}
NEO.Con.LMM.All.summary <-data.frame(Response_variable = "Concurrent uNEO", Fixed_Effect = c("FreqAllProx", "FreqTotalGr", "FreqGRRec", "FreqGRGiven", "FreqTimeSpentCop", "FreqTimeSpentConsort"), "Estimate" = c(summary(NEO.Con.LMM1)$coef[2,"Estimate"], summary(NEO.Con.LMM2)$coef[2,"Estimate"], summary(NEO.Con.LMM3)$coef[2,"Estimate"], summary(NEO.Con.LMM4)$coef[2,"Estimate"], summary(NEO.Con.LMM5)$coef[2,"Estimate"], summary(NEO.Con.LMM6)$coef[2,"Estimate"]), "P_value" = c(AnovaNEO.Con.LMM1[2,3], AnovaNEO.Con.LMM2[2,3], AnovaNEO.Con.LMM3[2,3], AnovaNEO.Con.LMM4[2,3], AnovaNEO.Con.LMM5[2,3], AnovaNEO.Con.LMM6[2,3]))

NEO.Con.LMM.All.summary <- NEO.Con.LMM.All.summary %>%
  mutate_if(is.numeric, round, 3) %>%
  mutate("P_value" = cell_spec(P_value, "html", color = ifelse(P_value > 0.05, "black", "red"))) %>%
  kable(format="html", escape = F) %>%
  kable_styling(full_width=TRUE) %>%
  column_spec(4, background = "lightyellow"); NEO.Con.LMM.All.summary
```



### Concurrent NEO Total grooming drop1 analysis
```{r echo= FALSE}
library(lmerTest)
```

```{r}
NEO.Con.LMM.TotalGr.drop1model=lmer(log(NEO.CR)~ FreqTotalGrJuv + FreqTotalGrAM + FreqGRAF + RelRank +  (1|ID) + (1|Month), data=Concurrent_NEO, REML=FALSE)
```

```{r echo=FALSE}
NEO.Con.LMM.TotalGr.drop1test <- as.data.frame(drop1(NEO.Con.LMM.TotalGr.drop1model, test= "Chi")); NEO.Con.LMM.TotalGr.drop1test

NEO.Con.LMM.TotalGr.drop1test.tidy <- NEO.Con.LMM.TotalGr.drop1test %>%
  rownames_to_column(var= "Fixed Effect") %>%
  rename("P_value" = "Pr(>F)") %>%
  mutate_if(is.numeric, round, 3) %>%
  mutate("P_value" = cell_spec(P_value, "html", color = ifelse(P_value > 0.05, "black", "red"))) %>%
  kable(format="html", escape = F) %>%
  column_spec(7, background = "lightyellow") %>%
  kable_styling(full_width=TRUE); NEO.Con.LMM.TotalGr.drop1test.tidy
```


### Concurrent NEO Receiving grooming drop1 analysis
```{r echo=FALSE}
library(lmerTest)
```


```{r}
NEO.Con.LMM.RecGr.drop1model=lmer(log(NEO.CR)~ FreqGrRecJuv + FreqGrRecAM + FreqGrRecAF + RelRank + (1|ID) + (1|Month), data=Concurrent_NEO, REML=FALSE)
```

```{r echo=FALSE}
NEO.Con.LMM.RecGr.drop1test <- as.data.frame(drop1(NEO.Con.LMM.RecGr.drop1model, test= "Chi"))

NEO.Con.LMM.RecGr.drop1test.tidy <- NEO.Con.LMM.RecGr.drop1test %>%
  rownames_to_column(var= "Fixed Effect") %>%
  rename("P_value" = "Pr(>F)") %>%
  mutate_if(is.numeric, round, 3) %>%
  mutate("P_value" = cell_spec(P_value, "html", color = ifelse(P_value > 0.05, "black", "red"))) %>%
  kable(format="html", escape = F) %>%
  column_spec(7, background = "lightyellow") %>%
  kable_styling(full_width=TRUE); NEO.Con.LMM.RecGr.drop1test.tidy
```


```{r echo=FALSE}
detach("package:lmerTest", unload=TRUE)
```


## SECTION 4: EARLY VS LATE IN MATING SEASON PAIRED T-TESTS
### Load the data:
```{r}
pairedGC<-read.csv("~/Google Drive/Projects/Masters/R input sheets/GC_paired_t_test.csv", h=T)
pairedNEO<-read.csv("~/Google Drive/Projects/Masters/R input sheets/NEO_paired_t_test.csv", h=T)
```

### Paired t-test Early vs. Late GC
```{r}
GCPairedt.test <- t.test(pairedGC$Early, pairedGC$Late, paired=TRUE); GCPairedt.test
```

<div class = "yellow">
```{r echo=FALSE}
cat("p= ",GCPairedt.test$p.value, ": non-significant difference between GCs early and late in the mating season.")
```
</div>

### Paired t-test Early vs. Late NEO
```{r}
NEOPairedt.test <- t.test(pairedNEO$Early, pairedNEO$Late, paired=TRUE); NEOPairedt.test
```

<div class = "yellow">
```{r echo=FALSE}
cat("p= ",NEOPairedt.test$p.value, ": NEO significantly higher late in the mating season.")
```
</div>


```{r echo=FALSE}
t.test.results<- data.frame(Marker= c("GC", "NEO"), t_value= c(GCPairedt.test$statistic, NEOPairedt.test$statistic), Mean_difference= c(GCPairedt.test$estimate, NEOPairedt.test$estimate), CI_low = c(GCPairedt.test$conf.int[2], NEOPairedt.test$conf.int[2]), CI_high= c(GCPairedt.test$conf.int[1], NEOPairedt.test$conf.int[1]), P_value= c(GCPairedt.test$p.value, NEOPairedt.test$p.value)); t.test.results

t.test.results.tidy <- t.test.results %>%
  mutate_if(is.numeric, round, 3) %>%
  mutate("P_value" = cell_spec(P_value, "html", color = ifelse(P_value > 0.05, "black", "red"))) %>%
  kable(format="html", escape = F) %>%
  column_spec(6, background = "lightyellow") %>%
  kable_styling(full_width=TRUE); t.test.results.tidy

```


## SECTION 5: TABLES

### Obj1 table
```{r echo=FALSE}

Obj1.Summary <-data.frame(Response_variable = c("fGC", "", "", "", "Time-lagged uNEO", "", "", "", "Concurrent uNEO", "", "", ""), Fixed_Effect = c("Proximity", "Total Grooming", "Receiving Grooming", "Giving Grooming", "Proximity", "Total Grooming", "Receiving Grooming", "Giving Grooming", "Proximity", "Total Grooming", "Receiving Grooming", "Giving Grooming"), "Estimate" = c(summary(GC.LMM1)$coef[2,"Estimate"], summary(GC.LMM2)$coef[2,"Estimate"], summary(GC.LMM3)$coef[2,"Estimate"], summary(GC.LMM4)$coef[2,"Estimate"], summary(NEO.TL.LMM1)$coef[2,"Estimate"], summary(NEO.TL.LMM2)$coef[2,"Estimate"], summary(NEO.TL.LMM3)$coef[2,"Estimate"], summary(NEO.TL.LMM4)$coef[2,"Estimate"], summary(NEO.Con.LMM1)$coef[2,"Estimate"], summary(NEO.Con.LMM2)$coef[2,"Estimate"], summary(NEO.Con.LMM3)$coef[2,"Estimate"], summary(NEO.Con.LMM4)$coef[2,"Estimate"]), Std_Error= c(summary(GC.LMM1)$coef[2, "Std. Error"], summary(GC.LMM2)$coef[2, "Std. Error"], summary(GC.LMM3)$coef[2, "Std. Error"], summary(GC.LMM4)$coef[2, "Std. Error"],summary(NEO.TL.LMM1)$coef[2,"Std. Error"], summary(NEO.TL.LMM2)$coef[2,"Std. Error"], summary(NEO.TL.LMM3)$coef[2,"Std. Error"], summary(NEO.TL.LMM4)$coef[2,"Std. Error"], summary(NEO.Con.LMM1)$coef[2,"Std. Error"], summary(NEO.Con.LMM2)$coef[2,"Std. Error"], summary(NEO.Con.LMM3)$coef[2,"Std. Error"], summary(NEO.Con.LMM4)$coef[2,"Std. Error"]), t_value= c(summary(GC.LMM1)$coef[2, "t value"], summary(GC.LMM2)$coef[2, "t value"], summary(GC.LMM3)$coef[2, "t value"], summary(GC.LMM4)$coef[2, "t value"], summary(NEO.TL.LMM1)$coef[2,"t value"], summary(NEO.TL.LMM2)$coef[2,"t value"], summary(NEO.TL.LMM3)$coef[2,"t value"], summary(NEO.TL.LMM4)$coef[2,"t value"], summary(NEO.Con.LMM1)$coef[2,"t value"], summary(NEO.Con.LMM2)$coef[2,"t value"], summary(NEO.Con.LMM3)$coef[2,"t value"], summary(NEO.Con.LMM4)$coef[2,"t value"]), Walds_Chi_square= c(AnovaGC.LMM1[2,1], AnovaGC.LMM2[2,1], AnovaGC.LMM3[2,1], AnovaGC.LMM4[2,1], AnovaNEO.TL.LMM1[2,1], AnovaNEO.TL.LMM2[2,1], AnovaNEO.TL.LMM3[2,1], AnovaNEO.TL.LMM4[2,1], AnovaNEO.Con.LMM1[2,1], AnovaNEO.Con.LMM2[2,1], AnovaNEO.Con.LMM3[2,1], AnovaNEO.Con.LMM4[2,1]), P_value = c(AnovaGC.LMM1[2,3], AnovaGC.LMM2[2,3], AnovaGC.LMM3[2,3], AnovaGC.LMM4[2,3], AnovaNEO.TL.LMM1[2,3], AnovaNEO.TL.LMM2[2,3], AnovaNEO.TL.LMM3[2,3], AnovaNEO.TL.LMM4[2,3], AnovaNEO.Con.LMM1[2,3], AnovaNEO.Con.LMM2[2,3], AnovaNEO.Con.LMM3[2,3], AnovaNEO.Con.LMM4[2,3]))

Obj1.Summary <- Obj1.Summary %>%
  mutate_if(is.numeric, round, 3) %>%
  mutate(P_value = cell_spec(P_value, "html", bold = ifelse(P_value > 0.05, FALSE, TRUE), color= ifelse(P_value > 0.05, "gray", "black"))) %>%
  rename("P-value" = P_value, "Wald's χ2" = Walds_Chi_square, "t-value" = t_value, "Std. Error"= Std_Error, "Fixed Effect*"= Fixed_Effect, "Response Variable"= Response_variable) %>%
  kable(format="html", escape = F) %>%
  kable_styling("striped", full_width=TRUE) %>%
  pack_rows(index = c("Objective 1.1" = 4, "Objective 1.2" = 8)) %>%
  column_spec(1, color = "black") %>%
  column_spec(2, color = "black") %>%
  footnote(general = "*All models include male dominance rank as a covariate",
           general_title = "") %>%
  save_kable("Table1.pdf")

#Save as width 900 height 570
```

### Obj 2 table
```{r echo=FALSE}
Obj2.Summary <-data.frame(Response_variable = c("fGC", "", "Time-lagged uNEO", "", "Concurrent uNEO", ""), Fixed_Effect = c("Copulation", "Consort", "Copulation", "Consort", "Copulation", "Consort"), "Estimate" = c(summary(GC.LMM5)$coef[2,"Estimate"], summary(GC.LMM6)$coef[2,"Estimate"],  summary(NEO.TL.LMM5)$coef[2,"Estimate"], summary(NEO.TL.LMM6)$coef[2,"Estimate"],  summary(NEO.Con.LMM5)$coef[2,"Estimate"], summary(NEO.Con.LMM6)$coef[2,"Estimate"]), Std_Error= c(summary(GC.LMM5)$coef[2, "Std. Error"], summary(GC.LMM6)$coef[2, "Std. Error"], summary(NEO.TL.LMM5)$coef[2,"Std. Error"], summary(NEO.TL.LMM6)$coef[2,"Std. Error"], summary(NEO.Con.LMM5)$coef[2,"Std. Error"], summary(NEO.Con.LMM6)$coef[2,"Std. Error"]), t_value= c(summary(GC.LMM5)$coef[2, "t value"], summary(GC.LMM6)$coef[2, "t value"], summary(NEO.TL.LMM5)$coef[2,"t value"], summary(NEO.TL.LMM6)$coef[2,"t value"], summary(NEO.Con.LMM5)$coef[2,"t value"], summary(NEO.Con.LMM6)$coef[2,"t value"]), Walds_Chi_square= c(AnovaGC.LMM5[2,1], AnovaGC.LMM6[2,1], AnovaNEO.TL.LMM5[2,1], AnovaNEO.TL.LMM6[2,1], AnovaNEO.Con.LMM5[2,1], AnovaNEO.Con.LMM6[2,1]), P_value = c(AnovaGC.LMM5[2,3], AnovaGC.LMM6[2,3], AnovaNEO.TL.LMM5[2,3], AnovaNEO.TL.LMM6[2,3], AnovaNEO.Con.LMM5[2,3], AnovaNEO.Con.LMM6[2,3]))

Obj2.Summary <- Obj2.Summary %>%  
  mutate_if(is.numeric, round, 3) %>%
  mutate(P_value = cell_spec(P_value, "html", bold = ifelse(P_value > 0.05, FALSE, TRUE), color= ifelse(P_value > 0.05, "gray", "black"))) %>%
  rename("P-value" = P_value, "Wald's χ2" = Walds_Chi_square, "t-value" = t_value, "Std. Error"= Std_Error, "Fixed Effect*"= Fixed_Effect, "Response Variable"= Response_variable) %>%
  kable(format="html", escape = F) %>%
  kable_styling("striped", full_width=TRUE) %>%
  pack_rows(index = c("Objective 2.1" = 2, "Objective 2.2" = 4)) %>%
  column_spec(1, color = "black") %>%
  column_spec(2, color = "black") %>%
  footnote(general = "*All models include rank as a covariate",
           general_title = "") %>%
  save_kable("Table2.pdf")

#Save as width 900, height 350
```

### Obj 3 table
```{r echo=FALSE}
t.test.results<- data.frame(Marker= c("fGC", "uNEO"), t_value= c(GCPairedt.test$statistic, NEOPairedt.test$statistic), Mean_difference= c(GCPairedt.test$estimate, NEOPairedt.test$estimate), CI_high = c(GCPairedt.test$conf.int[2], NEOPairedt.test$conf.int[2]), CI_low= c(GCPairedt.test$conf.int[1], NEOPairedt.test$conf.int[1]), P_value= c(GCPairedt.test$p.value, NEOPairedt.test$p.value))

t.test.results <- t.test.results %>%  
  mutate_if(is.numeric, round, 3) %>%
  mutate(P_value = cell_spec(P_value, "html", bold = ifelse(P_value > 0.05, FALSE, TRUE), color= ifelse(P_value > 0.05, "gray", "black"))) %>%
  rename(" "= Marker, "P-value" = P_value, "Mean difference" = Mean_difference, "t-value" = t_value, "95% CI (high)"= CI_high, "95% CI (low)"= CI_low) %>%
  kable(format="html", escape = F) %>%
  kable_styling("striped", full_width=TRUE) %>%
  column_spec(1, color = "black") %>%
  pack_rows(index = c("Objective 3.1" = 1, "Objective 3.2" = 1)) %>%
  kable_save("Table3.pdf")

```


## SECTION 6: FIGURES

### read in data:
```{r}
GC_Behavior<-read.csv("~/Google Drive/Projects/Masters/R input sheets/GC_behavior_matched.csv", h=T)
TL_NEO<-read.csv("~/Google Drive/Projects/Masters/R input sheets/Time-lagged_NEO.csv", h=T)
Concurrent_NEO<-read.csv("~/Google Drive/Projects/Masters/R input sheets/Concurrent_NEO.csv", h=T)
boxplot<-read.csv("~/Google Drive/Projects/Masters/R input sheets/GC_NEO_boxplot.csv",h=T)
```


### Fig1. Objective 1.1
```{r echo=FALSE, warning=FALSE, results= 'hide', message=FALSE, fig.show='hide'}
GC.LMM1=lmer(log(GC.final.conc)~ FreqAllProx + RelRank + (1|ID) + (1|Month), data=GC_Behavior)
ef <- effect("FreqAllProx", GC.LMM1, xlevels=list(FreqAllProx=GC_Behavior$FreqAllProx))
x <- as.data.frame(ef)
GCProx.plot <- ggplot(x, aes(FreqAllProx, fit)) + 
  geom_line()  + 
  geom_point(size=1) +
  geom_errorbar(aes(ymin=fit-se,
                    ymax=fit+se), width=0.001, colour="gray", alpha=0.2) +
  theme_light(base_size=10) +
  labs(y=expression(paste("fGC (ng/g dry weight)"^"\u2020")), 
       x="Individuals within 5m per Scan") +
  theme(axis.title = element_text(size=11, color="black"),
        axis.title.y= element_text(size=16))

GC.LMM1.Ests<-plot_model(GC.LMM1, show.values=TRUE, title="", axis.labels=c("Rank", "Proximity"), colors= c("black", "gray44"), group.terms=c(1,2), dot.size = 1, line.size = 0.5) +
  set_theme(axis.title.size=1)

Fig1.Obj1.1 <- ggarrange(GCProx.plot, GC.LMM1.Ests, labels= c("(a)", "(b)"), font.label = list(size = 11)) + 
  annotation_custom(grid.rect(.5,.5, width=unit(1,"npc"), height=unit(1,"npc"), gp=gpar(lwd=3, fill=NA, col="black"), draw=TRUE)) 

Fig1.Obj1.1 <- annotate_figure(Fig1.Obj1.1, bottom = text_grob(expression(paste("* p< 0.05; ** p<0.01; ", "\u2020", " ln transformed")), hjust = 3.7, x = 1, face = "italic", size = 8)); Fig1.Obj1.1

ggsave("~/Google Drive/Projects/Masters/BES MS/Figures/Fig1.pdf", Fig1.Obj1.1, width= 174, height= 100, units= "mm", device=cairo_pdf)
```
```{r echo=FALSE}
Fig1.Obj1.1
```



### Fig2. Objective 1.2
```{r echo=FALSE, warning=FALSE, results='hide', message=FALSE, fig.show='hide'}
NEO.TL.LMM2=lmer(log(NEO.CR)~ FreqTotalGR + RelRank + (1|ID) +(1|Month), data=TL_NEO)
ef <- effect("FreqTotalGR", NEO.TL.LMM2, xlevels=list(FreqTotalGR=TL_NEO$FreqTotalGR))
x <- as.data.frame(ef)
NEOTLtotalGr.plot <- ggplot(x, aes(FreqTotalGR, fit)) + 
  geom_line()  + 
  geom_point(size=0.8) +
  geom_errorbar(aes(ymin=fit-se,
                    ymax=fit+se), width=0.001, color="gray", alpha=0.2) +
  theme_light(base_size=6) +
  labs(y=expression(paste("Time-lagged uNEO (ng/mg CR)"^"\u2020")), 
       x="Total Grooming Rate") +
  theme(axis.title = element_text(size=6, color="black"),
        axis.title.y=element_text(size=8))


NEO.TL.LMM2.Ests<-plot_model(NEO.TL.LMM2, show.values=TRUE, value.size=2, dot.size = 0.8, line.size = 0.5, colors=c("gray44", "black"), title="", axis.labels=c("Rank", "Total\n Grooming")) +
  set_theme(axis.textsize.x=.8 ,axis.textsize.y = .6, axis.title.size=0.6)

NEO.TL.Total.Gr.plots <- ggarrange(NEOTLtotalGr.plot, NEO.TL.LMM2.Ests, labels= c("(a)", "(b)"), font.label = list(size = 8))

NEO.TL.LMM3=lmer(log(NEO.CR)~ FreqGRRec + RelRank + (1|ID) +(1|Month), data=TL_NEO)
ef <- effect("FreqGRRec", NEO.TL.LMM3, xlevels=list(FreqGRRec=TL_NEO$FreqGRRec))
x <- as.data.frame(ef)
NEOTLrecGr.plot <- ggplot(x, aes(FreqGRRec, fit)) + 
  geom_line()  + 
  geom_point(size=0.8) +
  geom_errorbar(aes(ymin=fit-se,
                    ymax=fit+se), width=0.001, color="gray", alpha=0.2) +
  theme_light(base_size=6) +
  labs(y=" ", x="Receiving Grooming Rate") +
  theme(axis.title = element_text(size=6, color="black"))

NEO.TL.LMM3.Ests<-plot_model(NEO.TL.LMM3, show.values=TRUE, value.size=2, dot.size = 0.8, line.size = 0.5, colors=c("gray44", "black"), title="", axis.labels=c("Rank", "Receiving\n Grooming")) +
  set_theme(axis.textsize.x=.8 ,axis.textsize.y = .6, axis.title.size=0.6)

NEO.TL.Gr.Rec.plots <- ggarrange(NEOTLrecGr.plot, NEO.TL.LMM3.Ests, labels= c("(c)", "(d)"), font.label = list(size = 8))
NEO.TL.All.plots <- ggarrange(NEO.TL.Total.Gr.plots, NEO.TL.Gr.Rec.plots) +
  annotation_custom(grid.rect(.5,.5, width=unit(1,"npc"), height=unit(1,"npc"), gp=gpar(lwd=3, fill=NA, col="black"), draw=TRUE))

NEO.Con.LMM2=lmer(log(NEO.CR)~ FreqTotalGR + RelRank + (1|ID) +(1|Month), data=Concurrent_NEO)
ef <- effect("FreqTotalGR", NEO.Con.LMM2, xlevels=list(FreqTotalGR=Concurrent_NEO$FreqTotalGR))
x <- as.data.frame(ef)
NEOCONtotalGr.plot <- ggplot(x, aes(FreqTotalGR, fit)) + 
  geom_line()  + 
  geom_point(size=0.8) +
  geom_errorbar(aes(ymin=fit-se,
                    ymax=fit+se), width=0.001, color="gray", alpha=0.2) +
  theme_light(base_size=6) +
  scale_y_continuous(n.breaks=4) +
  labs(y=expression(paste("Concurrent uNEO (ng/mg CR)"^"\u2020")), 
       x="Total Grooming Rate") +
  theme(axis.title = element_text(size=6, color="black"),
        axis.title.y = element_text(size = 8))

NEO.Con.LMM2.Ests<-plot_model(NEO.Con.LMM2, show.values=TRUE, value.size=2, dot.size = 0.8, line.size = 0.5, colors=c("gray44", "black"), title="", axis.labels=c("Rank", "Total\n Grooming")) +
  set_theme(axis.textsize.x=.8 ,axis.textsize.y = .6, axis.title.size=0.6)

NEO.Con.Total.Gr.plots <- ggarrange(NEOCONtotalGr.plot, NEO.Con.LMM2.Ests, labels= c("(e)", "(f)"), font.label = list(size = 8)) 

NEO.Con.LMM3=lmer(log(NEO.CR)~ FreqGRRec + RelRank + (1|ID) +(1|Month), data=Concurrent_NEO)
ef <- effect("FreqGRRec", NEO.Con.LMM3, xlevels=list(FreqGRRec=Concurrent_NEO$FreqGRRec))
x <- as.data.frame(ef)

NEOCONGrRec.plot <- ggplot(data=x, aes(x=FreqGRRec, y=fit)) + 
  geom_line()  + 
  geom_point(size=0.8) +
  geom_errorbar(aes(ymin=fit-se,
                    ymax=fit+se), width=0.001, colour="gray", alpha=0.2) +
  theme_light(base_size=6) +
  scale_y_continuous(n.breaks=4, labels=c(5.2,5.4, 5.6, "")) +
  labs(y=" ", x="Receiving Grooming Rate") +
  theme(axis.title = element_text(size=6, color="black"))

NEO.Con.LMM3.Ests<-plot_model(NEO.Con.LMM3, show.values=TRUE, value.size=2, dot.size = 0.8, line.size = 0.5, colors=c("gray44", "black"), title="", axis.labels=c("Rank", "Receiving\n Grooming")) +
  set_theme(axis.textsize.x=.8 ,axis.textsize.y = .6, axis.title.size=0.6)

NEO.Con.Gr.Rec.plots <- ggarrange(NEOCONGrRec.plot, NEO.Con.LMM3.Ests, labels= c("(g)", "(h)"), font.label = list(size = 8)) 

NEO.Con.All.plots<-ggarrange(NEO.Con.Total.Gr.plots, NEO.Con.Gr.Rec.plots) +
  annotation_custom(grid.rect(.5,.5, width=unit(1,"npc"), height=unit(1,"npc"), gp=gpar(lwd=3, fill=NA, col="black"), draw=TRUE)) 

Fig2.Obj1.2<- ggarrange(NEO.TL.All.plots, NEO.Con.All.plots, nrow=2, ncol=1)

Fig2.Obj1.2 <- annotate_figure(Fig2.Obj1.2, bottom = text_grob(expression(paste("* p< 0.05; ** p<0.01; ", "\u2020", " ln transformed")), hjust = 4.9, x = 1, face = "italic", size = 6)); Fig2.Obj1.2

ggsave("~/Google Drive/Projects/Masters/BES MS/Figures/Fig2.pdf", Fig2.Obj1.2, width= 174, height= 120, units= "mm", device=cairo_pdf)
```

```{r echo=FALSE}
Fig2.Obj1.2
```

### Fig3. Objective 2 
```{r echo=FALSE, warning=FALSE, message=FALSE, results='hide', fig.show='hide'}
NEO.Con.LMM5=lmer(log(NEO.CR)~ FreqTimeSpentCop + RelRank + (1|ID) +(1|Month), data=Concurrent_NEO)
ef <- effect("FreqTimeSpentCop", NEO.Con.LMM5, xlevels=list(FreqTimeSpentCop=Concurrent_NEO$FreqTimeSpentCop))
x <- as.data.frame(ef)
NEOCONFreqCop.plot <- ggplot(data=x, aes(x=FreqTimeSpentCop, y=fit)) + 
  geom_line()  + 
  geom_point(size=1) +
  geom_errorbar(aes(ymin=fit-se,
                    ymax=fit+se), width=0.0001, colour="gray", alpha=0.2) +
  theme_light(base_size=10) +
  scale_x_continuous(limits=c(0.0,0.08)) +
  labs(y=expression(paste("Concurrent uNEO (ng/mg CR)"^"\u2020")), x="Copulation Rate") +
  theme(axis.title = element_text(size=11, color="black"),
        axis.title.y= element_text(size=14))


NEO.Con.LMM5.Ests<-plot_model(NEO.Con.LMM5, show.values=TRUE, title="", colors=c("black", "gray44"), axis.labels=c("Rank", "Copulation"), dot.size = 1, line.size = 0.5, group.terms=c(1,2)) +
  set_theme(axis.title.size=1)


Fig3.Obj2 <- ggarrange(NEOCONFreqCop.plot, NEO.Con.LMM5.Ests, labels= c("(a)", "(b)"), font.label = list(size = 11)) +
  annotation_custom(grid.rect(.5,.5, width=unit(1,"npc"), height=unit(1,"npc"), gp=gpar(lwd=3, fill=NA, col="black"), draw=TRUE))

Fig3.Obj2 <- annotate_figure(Fig3.Obj2, bottom = text_grob(expression(paste("* p< 0.05; ** p<0.01; ", "\u2020", " ln transformed")), hjust = 3.7, x = 1, face = "italic", size = 8)); Fig3.Obj2

ggsave("~/Google Drive/Projects/Masters/BES MS/Figures/Fig3.pdf", Fig3.Obj2, width= 174, height= 100, units= "mm", device=cairo_pdf)

```

```{r echo=FALSE}
Fig3.Obj2
```

### Fig4. Objective 3

```{r echo=FALSE, warning=FALSE, results='hide', message=FALSE, fig.show='hide'}
GCbox <- ggplot(boxplot, aes(Time.in.Mating.Season, GC, fill= Time.in.Mating.Season)) +
  geom_boxplot(alpha=1) +
  labs(x="Mating Season Progression", 
       y=expression(paste("fGC (ng/g dry weight)"))) +
  theme_light() +
  theme(legend.position="none",
        axis.title.y=element_text(size=16),
        axis.title.x = element_text(size=12)) +
  scale_fill_manual(values=c("lightgray", "darkgray"))
NEObox <- ggplot(boxplot, aes(Time.in.Mating.Season, NEO, fill= Time.in.Mating.Season)) +
  geom_boxplot(alpha=1) +
  labs(x="Mating Season Progression", 
       y=expression(paste("uNEO (ng/mg CR)"))) +
  theme_light()+ 
  theme(legend.position="none",
        axis.title.y=element_text(size=16),
        axis.title.x = element_text(size=12))+
  scale_fill_manual(values=c("lightgray", "darkgray"))+
  annotate(geom="text", x=1.5, y=500, label="**", size=8)

Fig4.Obj3 <- ggarrange(GCbox, NEObox, labels= c("(a)", "(b)"), font.label = list(size = 11)) +
  annotation_custom(grid.rect(.5,.5, width=unit(1,"npc"), height=unit(1,"npc"), gp=gpar(lwd=3, fill=NA, col="black"), draw=TRUE))

Fig4.Obj3 <- annotate_figure(Fig4.Obj3, bottom = text_grob("* p< 0.05; ** p<0.01", hjust = 7, x = 1, size = 8)); Fig4.Obj3

ggsave("~/Google Drive/Projects/Masters/BES MS/Figures/Fig4.pdf", Fig4.Obj3, width= 174, height= 100, units= "mm", device=cairo_pdf)
```

```{r echo=FALSE}
Fig4.Obj3
```



