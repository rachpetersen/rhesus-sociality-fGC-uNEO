---
title: "BES_behavioral_immunology"
author: "Rachel"
date: "5/19/2020"
output: html_document
---
```{r global_options, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
```

<style>
div.yellow pre { background-color:lightyellow; }
</style>

## LOAD LIBRARIES
```{r message=FALSE, results='hide'}
x<-c("car", "lme4", "effects", "ggplot2", "grid", "gridExtra", "dplyr", "tibble", "stringr", "condformat", 'kableExtra', 'crayon', 'fitdistrplus', 'sjPlot', "tidyverse", "ggpubr", "cowplot", "lubridate", "hms", "chron")
lapply(x, require, character.only = TRUE)
```


## SUMMARY STATS: Number of minutes followed per day
```{r}
BehaviorOnly <- read.csv("~/Google Drive/Projects/Masters/R input sheets/RhesusFullBehavior.csv")

BehaviorOnly$TotalKnownDuration <- chron(times= BehaviorOnly$TotalKnownDuration, format= "h:m:s")

MeanDurations <- BehaviorOnly %>%
  summarise(mean_duration = mean(TotalKnownDuration), sd_duration = sd(TotalKnownDuration))


MeanDurations$sd_duration <- chron(times= MeanDurations$sd_duration, format= "h:m:s")
```

##SUMMARY STATS: Mean durations of behavior per focal
Social behaviors
```{r}
FullBehavior <- read.csv("RhesusFullBehavior.csv")

BehaviorperFocal <- FullBehavior %>%
  mutate(TotalGRper30 = FreqTotalGR * 30) %>%
  mutate(RecGRper30 = FreqGRRec * 30) %>%
  mutate(GivenGRper30 = FreqGRGiven * 30)

MeanProx <- BehaviorperFocal %>%
  group_by(ID) %>%
  summarise(MeanProx = mean(FreqAllAdultProx), MinProx= min(FreqAllAdultProx), MaxProx= max(FreqAllAdultProx))
View(MeanProx)

MeanTotalGR <- BehaviorperFocal %>%
  group_by(ID) %>%
  summarise(MeanTotalGR = mean(TotalGRper30), MinTotalGR= min(TotalGRper30), MaxTotalGR= max(TotalGRper30))

MeanTotalGR$MeanTotalGR <- paste(floor(MeanTotalGR$MeanTotalGR), round((MeanTotalGR$MeanTotalGR-floor(MeanTotalGR$MeanTotalGR))*60), sep=":")

MeanTotalGR$MaxTotalGR <- paste(floor(MeanTotalGR$MaxTotalGR), round((MeanTotalGR$MaxTotalGR-floor(MeanTotalGR$MaxTotalGR))*60), sep=":")

MeanRecGR <- BehaviorperFocal %>%
  group_by(ID) %>%
  summarise(MeanRecGR = mean(RecGRper30), MinRecGR= min(RecGRper30), MaxRecGR= max(RecGRper30))

MeanRecGR$MeanRecGR <- paste(floor(MeanRecGR$MeanRecGR), round((MeanRecGR$MeanRecGR-floor(MeanRecGR$MeanRecGR))*60), sep=":")

MeanRecGR$MaxRecGR <- paste(floor(MeanRecGR$MaxRecGR), round((MeanRecGR$MaxRecGR-floor(MeanRecGR$MaxRecGR))*60), sep=":")

MeanGivenGR <- BehaviorperFocal %>%
  group_by(ID) %>%
  summarise(MeanGivenGR = mean(GivenGRper30), MinGivenGR= min(GivenGRper30), MaxGivenGR= max(GivenGRper30)) 

MeanGivenGR$MeanGivenGR <- paste(floor(MeanGivenGR$MeanGivenGR), round((MeanGivenGR$MeanGivenGR-floor(MeanGivenGR$MeanGivenGR))*60), sep=":")

MeanGivenGR$MaxGivenGR <- paste(floor(MeanGivenGR$MaxGivenGR), round((MeanGivenGR$MaxGivenGR-floor(MeanGivenGR$MaxGivenGR))*60), sep=":")

MeanGivenGR <- format.data.frame(MeanGivenGR, digits= 2)
  
#View(MeanProx)
#View(MeanTotalGR)
#View(MeanRecGR)
#View(MeanGivenGR)

```

Sexual behaviors
```{r}
Concurrent_NEO <- read.csv("Concurrent_NEO.csv")
View(Concurrent_NEO)

SexperFocal <- Concurrent_NEO %>%
  mutate(TotalConper30 = FreqTimeSpentConsort * 30) %>%
  mutate(TotalCopper30 = FreqTimeSpentCop * 30) 

MeanCon <- SexperFocal %>%
  group_by(ID) %>%
  summarise(MeanCon = mean(TotalConper30), MinCon= min(TotalConper30), MaxCon= max(TotalConper30))

MeanCon$MeanCon <- paste(floor(MeanCon$MeanCon), round((MeanCon$MeanCon-floor(MeanCon$MeanCon))*60), sep=":")

MeanCon$MaxCon <- paste(floor(MeanCon$MaxCon), round((MeanCon$MaxCon-floor(MeanCon$MaxCon))*60), sep=":")

#View(MeanCon)

MeanCop <- SexperFocal %>%
  group_by(ID) %>%
  summarise(MeanCop = mean(TotalCopper30), MinCop= min(TotalCopper30), MaxCop= max(TotalCopper30))

MeanCop$MeanCop <- paste(floor(MeanCop$MeanCop), round((MeanCop$MeanCop-floor(MeanCop$MeanCop))*60), sep=":")

MeanCop$MaxCop <- paste(floor(MeanCop$MaxCop), round((MeanCop$MaxCop-floor(MeanCop$MaxCop))*60), sep=":")

#View(MeanCop)
```

## IOR
```{r}
GroomingIOR <- read.csv("~/Google Drive/Projects/Masters/R input sheets/GroomingIOR.csv")
ScanIOR <- read.csv("~/Google Drive/Projects/Masters/R input sheets/ScanIOR.csv")
```

```{r}
GroomingIOR$LR <- chron(times= GroomingIOR$LR, format= "h:m:s")
GroomingIOR$CR <- chron(times= GroomingIOR$CR, format= "h:m:s")
```

```{r}
TotalGrIOR <- GroomingIOR %>%
  filter(Measure == "TotalGr")

cor.test(TotalGrIOR$CR, TotalGrIOR$LR)
```

```{r}
RecGrIOR <- GroomingIOR %>%
  filter(Measure == "RecGr")

cor.test(RecGrIOR$CR, RecGrIOR$LR)
```

```{r}
GiveGrIOR <- GroomingIOR %>%
  filter(Measure == "GiveGr")

cor.test(GiveGrIOR$CR, GiveGrIOR$LR)
```

```{r}
cor.test(ScanIOR$CR, ScanIOR$LR)
```


## OBJECTIVE 1

### GC LMMs (Models 1.1- 1.4)
```{r}
GC_Behavior_raw=read.csv("~/Google Drive/Projects/Masters/R input sheets/GC_behavior_matched.csv", h=T) 

GC_Behavior_raw$Behav_Date<- mdy(GC_Behavior_raw$Behav_Date)
GC_Behavior_raw$Month <- factor(GC_Behavior_raw$Month)


GC_Behavior <- GC_Behavior_raw %>%
  mutate(DateDiffCentered = (DateDiff - 2))
```

```{r}
GC.LMM1=lmer(log(GC.final.conc)~ FreqAllProx + RelRank  + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=GC_Behavior)

#model diagnostics
vif.GC.LMM1 <- vif(GC.LMM1)
write.csv(vif.GC.LMM1, "vif.GC.LMM1.csv")

pdf('GC.LMM1.frplot.pdf')
plot(fitted(GC.LMM1), resid(GC.LMM1), 
     main = "Fitted vs. Residual plot",
     xlab= "Residual values",
     ylab= "Fitted values")

text(x=5.8, y=1.6, labels="(A)", xpd = NA, cex=1.5, font=2)
dev.off()

pdf("GC.LMM1.qqplot.pdf")
qqnorm(resid(GC.LMM1))
text(x=-3.4, y=1.6, labels="(B)", xpd = NA, cex=1.5, font=2)
dev.off()


# model summary
summary(GC.LMM1)
AnovaGC.LMM1 <- Anova(GC.LMM1, type= "III")
tab_model(GC.LMM1, show.df= TRUE, show.stat=TRUE, show.se= TRUE, show.ci=FALSE, string.se = "SE",  string.stat = "t-value", p.val = "kr", pred.labels= c("(Intercept)", "Proximity", "Dominance rank", "Latency to sample collection (linear)", "Latency to sample collection (quadratic)"), dv.labels= "Response: fGC (log transformed)", file="GC.LMM1.html")

#model comparison
GC.LMM1.red=lmer(log(GC.final.conc)~ RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=GC_Behavior)

anova(GC.LMM1, GC.LMM1.red) #model including proximity not significantly better fit than reduced model
```

```{r}
GC.LMM2=lmer(log(GC.final.conc)~ FreqTotalGR + RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=GC_Behavior)

#model diagnostics
vif.GC.LMM2 <- vif(GC.LMM2)
write.csv(vif.GC.LMM2, "vif.GC.LMM2.csv")

pdf('GC.LMM2.frplot.pdf')
plot(fitted(GC.LMM2), resid(GC.LMM2),
    main = "Fitted vs. Residual plot",
     xlab= "Residual values",
     ylab= "Fitted values")
text(x=5.8, y=1.6, labels="(A)", xpd = NA, cex=1.5, font=2)
dev.off()


pdf('GC.LMM2.qqplot.pdf')
qqnorm(resid(GC.LMM2))
text(x=-3.4, y=1.6, labels="(B)", xpd = NA, cex=1.5, font=2)
dev.off()

#model summary
summary(GC.LMM2)
AnovaGC.LMM2 <- Anova(GC.LMM2, type="III")
tab_model(GC.LMM2, show.df= TRUE, show.stat=TRUE, show.se= TRUE, show.ci=FALSE, string.se = "SE",  string.stat = "t-value", p.val = "kr", pred.labels= c("(Intercept)", "Total grooming", "Dominance rank", "Latency to sample collection (linear)", "Latency to sample collection (quadratic)"), dv.labels= "Response: fGC (log transformed)", file="GC.LMM2.html")

#model comparison
GC.LMM2.red=lmer(log(GC.final.conc)~ RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=GC_Behavior)
anova(GC.LMM2, GC.LMM2.red) #model including total grooming not significantly better fit than reduced model.
```

```{r}
GC.LMM3=lmer(log(GC.final.conc)~ FreqGRRec + RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=GC_Behavior)


#model diagnostics
vif.GC.LMM3 <- vif(GC.LMM3)
write.csv(vif.GC.LMM3, "vif.GC.LMM3.csv")

pdf("GC.LMM3.frplot.pdf")
plot(fitted(GC.LMM3), resid(GC.LMM3),
    main = "Fitted vs. Residual plot",
     xlab= "Residual values",
     ylab= "Fitted values")
text(x=5.8, y=1.6, labels="(A)", xpd = NA, cex=1.5, font=2)
dev.off()

pdf("GC.LMM3.qqplot.pdf")
qqnorm(resid(GC.LMM3))
text(x=-3.4, y=1.6, labels="(B)", xpd = NA, cex=1.5, font=2)
dev.off()

#model summary
summary(GC.LMM3)
AnovaGC.LMM3 <- Anova(GC.LMM3, type= "III")
tab_model(GC.LMM3, show.df= TRUE, show.stat=TRUE, show.se= TRUE, show.ci=FALSE, string.se = "SE",  string.stat = "t-value", p.val = "kr", pred.labels= c("(Intercept)", "Receiving grooming", "Dominance rank", "Latency to sample collection (linear)", "Latency to sample collection (quadratic)"), dv.labels= "Response: fGC (log transformed)", file="GC.LMM3.html")


#model comparison
GC.LMM3.red=lmer(log(GC.final.conc)~ RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=GC_Behavior)

anova(GC.LMM3, GC.LMM3.red)
```

```{r}
GC.LMM4=lmer(log(GC.final.conc)~ FreqGRGiven + RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=GC_Behavior)

#model diagnostics
vif.GC.LMM4 <- vif(GC.LMM4)
write.csv(vif.GC.LMM4, "vif.GC.LMM4.csv")

pdf("GC.LMM4.frplot.pdf")
plot(fitted(GC.LMM4), resid(GC.LMM4),
    main = "Fitted vs. Residual plot",
     xlab= "Residual values",
     ylab= "Fitted values")
text(x=5.8, y=1.6, labels="(A)", xpd = NA, cex=1.5, font=2)
dev.off()

pdf("GC.LMM4.qqplot.pdf")
qqnorm(resid(GC.LMM4))
text(x=-3.4, y=1.6, labels="(B)", xpd = NA, cex=1.5, font=2)
dev.off()

#model summary
summary(GC.LMM4)
AnovaGC.LMM4 <- Anova(GC.LMM4, type= "III")
tab_model(GC.LMM4, show.df= TRUE, show.stat=TRUE, show.se= TRUE, show.ci=FALSE, string.se = "SE",  string.stat = "t-value", p.val = "kr", pred.labels= c("(Intercept)", "Giving grooming", "Dominance rank", "Latency to sample collection (linear)", "Latency to sample collection (quadratic)"), dv.labels= "Response: fGC (log transformed)", file="GC.LMM4.html")

#model comparison
GC.LMM4.red=lmer(log(GC.final.conc)~ RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=GC_Behavior)
anova(GC.LMM4, GC.LMM4.red) #model with giving grooming not sig better fit than model without
```

p adjust for 4 Obj 1 models with fGC as response variable
```{r}
GCcorSoc <- p.adjust(c(AnovaGC.LMM1[2,3], AnovaGC.LMM2[2,3], AnovaGC.LMM3[2,3], AnovaGC.LMM4[2,3]), method = "fdr"); GCcorSoc
```


### Time-lagged NEO LMMs (Models 1.5- 1.8)
```{r}
TL_NEO<-read.csv("~/Google Drive/Projects/Masters/R input sheets/Time-lagged_NEO.csv", h=T)

TL_NEO$Behav_Date <- mdy(TL_NEO$Behav_Date)

TL_NEO <- TL_NEO %>%
  mutate(DateDiffCentered = (DateDiff - 15))
```


```{r}
NEO.TL.LMM1=lmer(log(NEO.CR)~ FreqAllProx +  RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=TL_NEO)

#model diagnostics
vif.NEO.TL.LMM1 <- vif(NEO.TL.LMM1)
write.csv(vif.NEO.TL.LMM1, "vif.NEO.TL.LMM1.csv")

pdf("NEO.TL.LMM1.frplot.pdf")
plot(fitted(NEO.TL.LMM1), resid(NEO.TL.LMM1),
    main = "Fitted vs. Residual plot",
     xlab= "Residual values",
     ylab= "Fitted values")
text(x=4.7, y=1.3, labels="(A)", xpd = NA, cex=1.5, font=2)
dev.off()

pdf("NEO.TL.LMM1.qqplot.pdf")
qqnorm(resid(NEO.TL.LMM1))
text(x=-3.6, y=1.3, labels="(B)", xpd = NA, cex=1.5, font=2)
dev.off()

#model summary
summary(NEO.TL.LMM1)
AnovaNEO.TL.LMM1 <- Anova(NEO.TL.LMM1, type= "III")
tab_model(NEO.TL.LMM1, show.df= TRUE, show.stat=TRUE, show.se= TRUE, show.ci=FALSE, string.se = "SE",  string.stat = "t-value", p.val = "kr", pred.labels= c("(Intercept)", "Proximity", "Dominance rank", "Latency to sample collection (linear)", "Latency to sample collection (quadratic)"), dv.labels= "Response: uNEO (log transformed)", file="NEO.TL.LMM1.html")

# model comparison
NEO.TL.LMM1.red=lmer(log(NEO.CR)~ RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=TL_NEO)
anova(NEO.TL.LMM1, NEO.TL.LMM1.red) #model with proximity not sig better fit than model without
```


```{r}
NEO.TL.LMM2=lmer(log(NEO.CR)~ FreqTotalGR + RelRank +  DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=TL_NEO)

#model diagnostics
vif.NEO.TL.LMM2 <- vif(NEO.TL.LMM2)
write.csv(vif.NEO.TL.LMM2, "vif.NEO.TL.LMM2.csv")

pdf("NEO.TL.LMM2.frplot.pdf")
plot(fitted(NEO.TL.LMM2), resid(NEO.TL.LMM2),
    main = "Fitted vs. Residual plot",
     xlab= "Residual values",
     ylab= "Fitted values")
text(x=4.7, y=1.3, labels="(A)", xpd = NA, cex=1.5, font=2)
dev.off()


pdf("NEO.TL.LMM2.qqplot.pdf")
qqnorm(resid(NEO.TL.LMM2))
text(x=-3.6, y=1.3, labels="(B)", xpd = NA, cex=1.5, font=2)
dev.off()

#model summary
summary(NEO.TL.LMM2)
AnovaNEO.TL.LMM2 <- Anova(NEO.TL.LMM2, type= "III")
tab_model(NEO.TL.LMM2, show.df= TRUE, show.stat=TRUE, show.se= TRUE, show.ci=FALSE, string.se = "SE",  string.stat = "t-value", p.val = "kr", pred.labels= c("(Intercept)", "Total Grooming", "Dominance rank", "Latency to sample collection (linear)", "Latency to sample collection (quadratic)"), dv.labels= "Response: uNEO (log transformed)", file="NEO.TL.LMM2.html")

#model comparison
NEO.TL.LMM2.red=lmer(log(NEO.CR)~ RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=TL_NEO)
anova(NEO.TL.LMM2, NEO.TL.LMM2.red) #model including total grooming IS sig better fit than model without
```


```{r}
NEO.TL.LMM3=lmer(log(NEO.CR)~ FreqGRRec + RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=TL_NEO)

#model diagnostics
vif.NEO.TL.LMM3 <- vif(NEO.TL.LMM3)
write.csv(vif.NEO.TL.LMM3, "vif.NEO.TL.LMM3.csv")

pdf("NEO.TL.LMM3.frplot.pdf")
plot(fitted(NEO.TL.LMM3), resid(NEO.TL.LMM3),
    main = "Fitted vs. Residual plot",
     xlab= "Residual values",
     ylab= "Fitted values")
text(x=4.7, y=1.3, labels="(A)", xpd = NA, cex=1.5, font=2)
dev.off()


pdf("NEO.TL.LMM3.qqplot.pdf")
qqnorm(resid(NEO.TL.LMM3))
text(x=-3.6, y=1.3, labels="(B)", xpd = NA, cex=1.5, font=2)
dev.off()

#model summary
summary(NEO.TL.LMM3)
AnovaNEO.TL.LMM3 <- Anova(NEO.TL.LMM3, type= "III")
tab_model(NEO.TL.LMM3, show.df= TRUE, show.stat=TRUE, show.se= TRUE, show.ci=FALSE, string.se = "SE",  string.stat = "t-value", p.val = "kr", pred.labels= c("(Intercept)", "Receiving Grooming", "Dominance rank", "Latency to sample collection (linear)", "Latency to sample collection (quadratic)"), dv.labels= "Response: uNEO (log transformed)", file="NEO.TL.LMM3.html")


#model comparison
NEO.TL.LMM3.red=lmer(log(NEO.CR)~ RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=TL_NEO)
anova(NEO.TL.LMM3, NEO.TL.LMM3.red) #model without receiving grooming not sig better fit than model without
```


```{r}
NEO.TL.LMM4=lmer(log(NEO.CR)~ FreqGRGiven + RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=TL_NEO)


#model diagnostics
vif.NEO.TL.LMM4 <- vif(NEO.TL.LMM4)
write.csv(vif.NEO.TL.LMM4, "vif.NEO.TL.LMM4.csv")

pdf("NEO.TL.LMM4.frplot.pdf")
plot(fitted(NEO.TL.LMM4), resid(NEO.TL.LMM4),
    main = "Fitted vs. Residual plot",
     xlab= "Residual values",
     ylab= "Fitted values")
text(x=4.7, y=1.3, labels="(A)", xpd = NA, cex=1.5, font=2)
dev.off()


pdf("NEO.TL.LMM4.qqplot.pdf")
qqnorm(resid(NEO.TL.LMM4))
text(x=-3.6, y=1.3, labels="(B)", xpd = NA, cex=1.5, font=2)
dev.off()

#model summary
summary(NEO.TL.LMM4)
AnovaNEO.TL.LMM4 <- Anova(NEO.TL.LMM4, type= "III")
tab_model(NEO.TL.LMM4, show.df= TRUE, show.stat=TRUE, show.se= TRUE, show.ci=FALSE, string.se = "SE",  string.stat = "t-value", p.val = "kr", pred.labels= c("(Intercept)", "Giving Grooming", "Dominance rank", "Latency to sample collection (linear)", "Latency to sample collection (quadratic)"), dv.labels= "Response: uNEO (log transformed)", file="NEO.TL.LMM4.html")


#model comparison
NEO.TL.LMM4.red=lmer(log(NEO.CR)~ RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=TL_NEO)
anova(NEO.TL.LMM4, NEO.TL.LMM4.red) #model without giving grooming is not sig better fit than model without
```

p adjust for 4 Obj 1 models with time-lagged NEO as response variable
```{r}
TLNEOcorSoc <- p.adjust(c(AnovaNEO.TL.LMM1[2,3], AnovaNEO.TL.LMM2[2,3], AnovaNEO.TL.LMM3[2,3], AnovaNEO.TL.LMM4[2,3]), method = "fdr"); TLNEOcorSoc
```

### Concurrent NEO LMMs (Models 1.9- 1.12)

```{r}
Concurrent_NEO<-read.csv("~/Google Drive/Projects/Masters/R input sheets/Concurrent_NEO.csv", h=T)

Concurrent_NEO$Behav_Date <- mdy(Concurrent_NEO$Behav_Date)

Concurrent_NEO <- Concurrent_NEO %>%
  mutate(DateDiffCentered = DateDiff)
```


```{r}
NEO.Con.LMM1=lmer(log(NEO.CR)~ FreqAllProx  + RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=Concurrent_NEO)

#model diagnostics
vif.NEO.Con.LMM1 <- vif(NEO.Con.LMM1)
write.csv(vif.NEO.Con.LMM1, "vif.NEO.Con.LMM1.csv")

pdf("NEO.Con.LMM1.frplot.pdf")
plot(fitted(NEO.Con.LMM1), resid(NEO.Con.LMM1))
dev.off()

pdf("NEO.Con.LMM1.qqplot.pdf")
qqnorm(resid(NEO.Con.LMM1))
dev.off()

#model summary
summary(NEO.Con.LMM1)
AnovaNEO.Con.LMM1 <- Anova(NEO.Con.LMM1, type= "III")
tab_model(NEO.Con.LMM1, dv.labels= "uNEO (log transformed)", file="NEO.Con.LMM1.html")

#model comparison
NEO.Con.LMM1.red=lmer(log(NEO.CR)~ RelRank + DateDiffCentered +I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=Concurrent_NEO)
anova(NEO.Con.LMM1, NEO.Con.LMM1.red)
```


```{r}
NEO.Con.LMM2=lmer(log(NEO.CR)~ FreqTotalGR + RelRank +  DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=Concurrent_NEO)

#model diagnostics
vif.NEO.Con.LMM2 <- vif(NEO.Con.LMM2)
write.csv(vif.NEO.Con.LMM2, "vif.NEO.Con.LMM2.csv")

pdf("NEO.Con.LMM2.frplot.pdf")
plot(fitted(NEO.Con.LMM2), resid(NEO.Con.LMM2))
dev.off()

pdf("NEO.Con.LMM2.qqplot.pdf")
qqnorm(resid(NEO.Con.LMM2))
dev.off()

#model summary
summary(NEO.Con.LMM2)
AnovaNEO.Con.LMM2 <- Anova(NEO.Con.LMM2, type= "III")
tab_model(NEO.Con.LMM2, dv.labels= "uNEO (log transformed)", file="NEO.Con.LMM2.html")

#model comparison
NEO.Con.LMM2.red=lmer(log(NEO.CR)~ RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=Concurrent_NEO)
anova(NEO.Con.LMM2, NEO.Con.LMM2.red)
```


```{r}
NEO.Con.LMM3=lmer(log(NEO.CR)~ FreqGRRec + RelRank + DateDiffCentered +I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=Concurrent_NEO)

#model diagnostics
vif.NEO.Con.LMM3 <- vif(NEO.Con.LMM3)
write.csv(vif.NEO.Con.LMM3, "vif.NEO.Con.LMM3.csv")

pdf("NEO.Con.LMM3.frplot.pdf")
plot(fitted(NEO.Con.LMM3), resid(NEO.Con.LMM3))
dev.off()

pdf("NEO.Con.LMM3.qqplot.pdf")
qqnorm(resid(NEO.Con.LMM3))
dev.off()

#model summary
summary(NEO.Con.LMM3)
AnovaNEO.Con.LMM3 <- Anova(NEO.Con.LMM3, type= "III")
tab_model(NEO.Con.LMM3, dv.labels= "uNEO (log transformed)", file="NEO.Con.LMM3.html")

#model comparison
NEO.Con.LMM3.red=lmer(log(NEO.CR)~  RelRank + DateDiffCentered +I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=Concurrent_NEO)
anova(NEO.Con.LMM3, NEO.Con.LMM3.red)
```


```{r}
NEO.Con.LMM4=lmer(log(NEO.CR)~ FreqGRGiven + RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=Concurrent_NEO)

#model diagnostics
vif.NEO.Con.LMM4 <- vif(NEO.Con.LMM4)
write.csv(vif.NEO.Con.LMM4, "vif.NEO.Con.LMM4.csv")

pdf("NEO.Con.LMM4.frplot.pdf")
plot(fitted(NEO.Con.LMM4), resid(NEO.Con.LMM4))
dev.off()

pdf("NEO.Con.LMM4.qqplot.pdf")
qqnorm(resid(NEO.Con.LMM4))
dev.off()

#model summary
summary(NEO.Con.LMM4)
AnovaNEO.Con.LMM4 <- Anova(NEO.Con.LMM4, type= "III")
tab_model(NEO.Con.LMM4, dv.labels= "uNEO (log transformed)", file="NEO.Con.LMM4.html")

#model comparison
NEO.Con.LMM4.red=lmer(log(NEO.CR)~ RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=Concurrent_NEO)
anova(NEO.Con.LMM4, NEO.Con.LMM4.red)
```

p adjust for 4 Obj 1 models with concurrent uNEO as response variable
```{r}
ConNEOcorSoc <- p.adjust(c(AnovaNEO.Con.LMM1[2,3], AnovaNEO.Con.LMM2[2,3], AnovaNEO.Con.LMM3[2,3], AnovaNEO.Con.LMM4[2,3]), method = "fdr"); ConNEOcorSoc
```


# OBJECTIVE 2

### GC LMMs (Models 2.1 & 2.2)

```{r}
GC.LMM5=lmer(log(GC.final.conc)~ FreqTimeSpentCop + RelRank + DateDiffCentered +  I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=GC_Behavior)

#model diagnostics
vif.GC.LMM5<- vif(GC.LMM5)
write.csv(vif.GC.LMM5, "vif.GC.LMM5.csv")

pdf("GC.LMM5.frplot.pdf")
plot(fitted(GC.LMM5), resid(GC.LMM5),
    main = "Fitted vs. Residual plot",
     xlab= "Residual values",
     ylab= "Fitted values")
text(x=5.8, y=1.6, labels="(A)", xpd = NA, cex=1.5, font=2)
dev.off()

pdf("GC.LMM5.qqplot.pdf")
qqnorm(resid(GC.LMM5))
text(x=-3.4, y=1.6, labels="(B)", xpd = NA, cex=1.5, font=2)
dev.off()

#model summary
summary(GC.LMM5)
AnovaGC.LMM5 <- Anova(GC.LMM5, type= "III")
tab_model(GC.LMM5, show.df= TRUE, show.stat=TRUE, show.se= TRUE, show.ci=FALSE, string.se = "SE",  string.stat = "t-value", p.val = "kr", pred.labels= c("(Intercept)", "Copulation", "Dominance rank", "Latency to sample collection (linear)", "Latency to sample collection (quadratic)"), dv.labels= "Response: fGC (log transformed)", file="GC.LMM5.html")


#model comparison
GC.LMM5.red=lmer(log(GC.final.conc)~ RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=GC_Behavior)
anova(GC.LMM5, GC.LMM5.red) #model with copulation is not sig better fit than model without
```

```{r}
GC.LMM6=lmer(log(GC.final.conc)~ FreqTimeSpentConsort + RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=GC_Behavior)

#model diagnostic
vif.GC.LMM6 <- vif(GC.LMM6)
write.csv(vif.GC.LMM6, "vif.GC.LMM6.csv")

pdf("GC.LMM6.frplot.pdf")
plot(fitted(GC.LMM6), resid(GC.LMM6),
    main = "Fitted vs. Residual plot",
     xlab= "Residual values",
     ylab= "Fitted values")
text(x=5.8, y=1.6, labels="(A)", xpd = NA, cex=1.5, font=2)
dev.off()

pdf("GC.LMM6.qqplot.pdf")
qqnorm(resid(GC.LMM6))
text(x=-3.4, y=1.6, labels="(B)", xpd = NA, cex=1.5, font=2)
dev.off()

#model summary
summary(GC.LMM6)
AnovaGC.LMM6 <- Anova(GC.LMM6, type= "III")
tab_model(GC.LMM6, show.df= TRUE, show.stat=TRUE, show.se= TRUE, show.ci=FALSE, string.se = "SE",  string.stat = "t-value", p.val = "kr", pred.labels= c("(Intercept)", "Consortship", "Dominance rank", "Latency to sample collection (linear)", "Latency to sample collection (quadratic)"), dv.labels= "Response: fGC (log transformed)", file="GC.LMM6.html")

#model comparison
GC.LMM6.red=lmer(log(GC.final.conc)~ RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=GC_Behavior)
anova(GC.LMM6, GC.LMM6.red) #model with consortship not sig better fit than model without
```

p adjust for 2 Obj 2 models with fGC as response variable
```{r}
GCcorSex <- p.adjust(c(AnovaGC.LMM5[2,3], AnovaGC.LMM6[2,3]), method = "fdr"); GCcorSex
```


### Time-lagged NEO LMMs (Models 2.3 & 2.4)
```{r}
NEO.TL.LMM5=lmer(log(NEO.CR)~ FreqTimeSpentCop + RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=TL_NEO)

#model diagnostics
vif.NEO.TL.LMM5 <- vif(NEO.TL.LMM5)
write.csv(vif.NEO.TL.LMM5, "vif.NEO.TL.LMM5.csv")

pdf("NEO.TL.LMM5.frplot.pdf")
plot(fitted(NEO.TL.LMM5), resid(NEO.TL.LMM5))
dev.off()

pdf("NEO.TL.LMM5.qqplot.pdf")
qqnorm(resid(NEO.TL.LMM5))
dev.off()

#model summary
summary(NEO.TL.LMM5)
AnovaNEO.TL.LMM5 <- Anova(NEO.TL.LMM5, type= "III")
tab_model(NEO.TL.LMM5, dv.labels= "uNEO (log transformed)", file="NEO.TL.LMM5.html")

#model comparison
NEO.TL.LMM5.red=lmer(log(NEO.CR)~ RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=TL_NEO)
anova(NEO.TL.LMM5, NEO.TL.LMM5.red)
```


```{r}
NEO.TL.LMM6=lmer(log(NEO.CR)~ FreqTimeSpentConsort + RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=TL_NEO)

#model diagnostics
vif.NEO.TL.LMM6 <- vif(NEO.TL.LMM6)
write.csv(vif.NEO.TL.LMM6, "vif.NEO.TL.LMM6.csv")

pdf("NEO.TL.LMM6.frplot.pdf")
plot(fitted(NEO.TL.LMM6), resid(NEO.TL.LMM6))
dev.off()

pdf("NEO.TL.LMM6.qqplot.pdf")
qqnorm(resid(NEO.TL.LMM6))
dev.off()

#model summary
summary(NEO.TL.LMM6)
AnovaNEO.TL.LMM6 <- Anova(NEO.TL.LMM6, type= "III")
tab_model(NEO.TL.LMM6, dv.labels= "uNEO (log transformed)", file="NEO.TL.LMM6.html")


#model comparison
NEO.TL.LMM6.red=lmer(log(NEO.CR)~ RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=TL_NEO)
anova(NEO.TL.LMM6, NEO.TL.LMM6.red)
```

p adjust for 2 Obj 2 models with time-lagged NEO as response variable
```{r}
TLNEOcorSex <- p.adjust(c(AnovaNEO.TL.LMM5[2,3], AnovaNEO.TL.LMM6[2,3]), method = "fdr"); TLNEOcorSex
```


### Concurrent NEO LMMs (Models 2.5 & 2.6)
```{r}
NEO.Con.LMM5=lmer(log(NEO.CR)~ FreqTimeSpentCop + RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=Concurrent_NEO)

#model diagnostics
vif.NEO.Con.LMM5 <- vif(NEO.Con.LMM5)
write.csv(vif.NEO.Con.LMM5, "vif.NEO.Con.LMM5.csv")

pdf("NEO.Con.LMM5.frplot.pdf")
plot(fitted(NEO.Con.LMM5), resid(NEO.Con.LMM5))
dev.off()

pdf("NEO.Con.LMM5.qqplot.pdf")
qqnorm(resid(NEO.Con.LMM5))
dev.off()

#model summary
summary(NEO.Con.LMM5)
AnovaNEO.Con.LMM5 <- Anova(NEO.Con.LMM5, type= "III")
tab_model(NEO.Con.LMM5, dv.labels= "uNEO (log transformed)", file="NEO.Con.LMM5.html")

#model comparison
NEO.Con.LMM5.red=lmer(log(NEO.CR)~ RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=Concurrent_NEO)
anova(NEO.Con.LMM5, NEO.Con.LMM5.red)
```


```{r}
NEO.Con.LMM6=lmer(log(NEO.CR)~ FreqTimeSpentConsort + RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=Concurrent_NEO)

#model diagnostics
vif.NEO.Con.LMM6 <- vif(NEO.Con.LMM6)
write.csv(vif.NEO.Con.LMM6, "vif.NEO.Con.LMM6.csv")

pdf("NEO.Con.LMM6.frplot.pdf")
plot(fitted(NEO.Con.LMM6), resid(NEO.Con.LMM6))
dev.off()

pdf("NEO.Con.LMM6.qqplot.pdf")
qqnorm(resid(NEO.Con.LMM6))
dev.off()

#model summary
summary(NEO.Con.LMM6)
AnovaNEO.Con.LMM6 <- Anova(NEO.Con.LMM6, type= "III")
tab_model(NEO.Con.LMM6, dv.labels= "uNEO (log transformed)", file="NEO.Con.LMM6.html")

#model comparison
NEO.Con.LMM6.red=lmer(log(NEO.CR)~ RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=Concurrent_NEO)
anova(NEO.Con.LMM6, NEO.Con.LMM6.red)
```

p adjust for 2 Obj 2 models with concurrent uNEO as response variable
```{r}
ConNEOcorSex <- p.adjust(c(AnovaNEO.Con.LMM5[2,3], AnovaNEO.Con.LMM6[2,3]), method = "fdr"); ConNEOcorSex
```


### Concurrent NEO Total grooming drop1 analysis
```{r echo= FALSE}
library(lmerTest)
```

```{r}
NEO.Con.LMM.TotalGr.drop1model=lmer(log(NEO.CR)~ FreqTotalGrJuv + FreqTotalGrAM + FreqGRAF + RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) +  (1|ID) + (1|Behav_Date), data=Concurrent_NEO, REML=FALSE)
```

```{r echo=FALSE}
NEO.Con.LMM.TotalGr.drop1test <- as.data.frame(drop1(NEO.Con.LMM.TotalGr.drop1model, test= "Chi")); NEO.Con.LMM.TotalGr.drop1test

NEO.Con.LMM.TotalGr.drop1test.tidy <- NEO.Con.LMM.TotalGr.drop1test %>%
  rownames_to_column(var= "Fixed Effect") %>%
  rename("P_value" = "Pr(>F)") %>%
  mutate_if(is.numeric, round, 3) %>%
  mutate("P_value" = cell_spec(P_value, "html", color = ifelse(P_value > 0.05, "black", "red"))) %>%
  kable(format="html", escape = F) %>%
  column_spec(7, background = "lightyellow") %>%
  kable_styling(full_width=TRUE); NEO.Con.LMM.TotalGr.drop1test.tidy
```


### Concurrent NEO Receiving grooming drop1 analysis
```{r echo=FALSE}
library(lmerTest)
```


```{r}
NEO.Con.LMM.RecGr.drop1model=lmer(log(NEO.CR)~ FreqGrRecJuv + FreqGrRecAM + FreqGrRecAF + RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) + (1|Behav_Date), data=Concurrent_NEO, REML=FALSE)
```

```{r echo=FALSE}
NEO.Con.LMM.RecGr.drop1test <- as.data.frame(drop1(NEO.Con.LMM.RecGr.drop1model, test= "Chi"))

NEO.Con.LMM.RecGr.drop1test.tidy <- NEO.Con.LMM.RecGr.drop1test %>%
  rownames_to_column(var= "Fixed Effect") %>%
  rename("P_value" = "Pr(>F)") %>%
  mutate_if(is.numeric, round, 3) %>%
  mutate("P_value" = cell_spec(P_value, "html", color = ifelse(P_value > 0.05, "black", "red"))) %>%
  kable(format="html", escape = F) %>%
  column_spec(7, background = "lightyellow") %>%
  kable_styling(full_width=TRUE); NEO.Con.LMM.RecGr.drop1test.tidy
```

# OBJECTIVE 3

```{r}
GCunmatched <- read.csv("~/Google Drive/Projects/Masters/rhesus-sociality-fGC-uNEO/GCunmatched.csv")

NEOunmatched <- read.csv("~/Google Drive/Projects/Masters/rhesus-sociality-fGC-uNEO/NEOunmatched.csv")

```

## LMM changes in fGC over time (Model 3.1)
```{r}
#GC over time model
GC.month.mod <- lmer(log(final.conc) ~ Month + RelRank + (1|Focal.ID), data=GC)

#model diagnostics
vif.GC.month.mod <- vif(GC.month.mod)
write.csv(vif.GC.month.mod, "vif.GC.month.csv")

pdf("GC.month.frplot.pdf")
plot(fitted(GC.month.mod), resid(GC.month.mod))
dev.off()

pdf("GC.month.qqplot.pdf")
qqnorm(resid(GC.month.mod))
dev.off()

#model summary
summary(GC.month.mod)
AnovaGC.Month <- Anova(GC.month.mod6, type= "III")
tab_model(GC.month.mod, dv.labels= "fGC (log transformed)", file="GC.month.html")

#comparison to reduced model
GC.month.red <- lmer(log(final.conc) ~ Month + RelRank + (1|Focal.ID), data=GC)
anova(GC.month.mod, GC.month.red, type="III") #model including month not sig better fit. 
```


## LMM changes in uNEO over time (Model 3.2)
```{r}
NEO.month.mod <- lmer(log(NEO.CR) ~ Month  + RelRank + (1 |Animal.ID), data= NEOunmatched)

#model diagnostics
vif.NEO.month.mod <- vif(NEO.month.mod)
write.csv(vif.NEO.month.mod, "vif.NEO.month.csv")

pdf("NEO.month.frplot.pdf")
plot(fitted(NEO.month.mod), resid(NEO.month.mod))
dev.off()

pdf("NEO.month.qqplot.pdf")
qqnorm(resid(NEO.month.mod))
dev.off()

#model summary
summary(NEO.month.mod)
AnovaNEO.Month <- Anova(GC.month.mod6, type= "III")
tab_model(NEO.month.mod, dv.labels= "uNEO (log transformed)", file="NEO.month.html")

#comparison to reduced model
NEO.month.red <- lmer(log(NEO.CR) ~ RelRank + (1 |Animal.ID), data= NEOunmatched)
anova(NEO.month.mod, NEO.month.red, type= "III") #model including month sig better fit 
```

Does creatinine change over time?
```{r}
NEOunmatched$Date<- mdy(NEOunmatched$Date)

Cr.month.mod <- lmer(log(CR.DF) ~ Month + (1|Animal.ID), data= NEOunmatched)

#model diagnostics
pdf("CR.frplot.pdf")
plot(fitted(Cr.month.mod) ~ resid(Cr.month.mod))
dev.off()

pdf("CR.qqplot.pdf")
qqnorm(resid(Cr.month.mod))
dev.off()

#model summary
summary(Cr.month.mod)
Anova(Cr.month.mod)
tab_model(Cr.month.mod, dv.labels= "Creatinine (log transformed)", file="CR.mod.html")
```

How does mean uNEO change over time?
```{r}
AverageCR.DF <- NEOunmatched %>%
  group_by(Month) %>%
  summarise(mean = mean(CR.DF))

AverageCR.DF
#Jan mean= 1.06
#Feb mean= 0.552
#Mar mean= 0.596
#Apr mean= 0.513
```

## Model change in uNEO over time, excluding data from January (Model 3.3)
```{r}
NEOnoJan <- NEOunmatched %>%
  filter(Month != "1")

NEOnoJanmod <- lmer(log(NEO.CR) ~ Month + RelRank + (1 |Animal.ID), data= NEOnoJan)

#model diagnostics
vif.NEOnoJanmod <- vif(NEOnoJanmod)
write.csv(vif.NEOnoJanmod, "vif.NEOnoJan.csv")

pdf("NEOnoJan.frplot.pdf")
plot(fitted(NEOnoJanmod) ~ resid(NEOnoJanmod))
dev.off()

pdf("NEOnoJan.qqplot.pdf")
qqnorm(resid(NEOnoJanmod))
dev.off()

#model summary
summary(NEOnoJanmod)
AnovaNEO.MonthNOJAN <- Anova(NEOnoJanmod, type= "III")
tab_model(NEOnoJanmod, dv.labels= "Creatinine (log transformed)", file="NEOnoJan.html")

#comparison to reduced model
NEOnoJanmod.red <- lmer(log(NEO.CR) ~ RelRank + (1 |Animal.ID), data= NEOnoJan)
anova(NEOnoJanmod, NEOnoJanmod.red, type= "III") #model including month sig better fit
```

Adjust p-values for multiple hypothesis testing
```{r}
#Only one GC model- no correction needed 

NEOMonthModsCor <- p.adjust(c(AnovaNEO.Month[2,3], AnovaNEO.MonthNOJAN[2,3]), method= "fdr")

```


## TABLES

### Obj1 table
```{r echo=FALSE}
Obj1.Summary <-data.frame(Response_variable = c("fGC (n=163)", "", "", "", "Time-lagged uNEO (n=213)", "", "", "", "Concurrent uNEO (n=267)", "", "", ""), Fixed_Effect = c("Proximity", "Total Grooming", "Receiving Grooming", "Giving Grooming", "Proximity", "Total Grooming", "Receiving Grooming", "Giving Grooming", "Proximity", "Total Grooming", "Receiving Grooming", "Giving Grooming"), "Estimate" = c(summary(GC.LMM1)$coef[2,"Estimate"], summary(GC.LMM2)$coef[2,"Estimate"], summary(GC.LMM3)$coef[2,"Estimate"], summary(GC.LMM4)$coef[2,"Estimate"], summary(NEO.TL.LMM1)$coef[2,"Estimate"], summary(NEO.TL.LMM2)$coef[2,"Estimate"], summary(NEO.TL.LMM3)$coef[2,"Estimate"], summary(NEO.TL.LMM4)$coef[2,"Estimate"], summary(NEO.Con.LMM1)$coef[2,"Estimate"], summary(NEO.Con.LMM2)$coef[2,"Estimate"], summary(NEO.Con.LMM3)$coef[2,"Estimate"], summary(NEO.Con.LMM4)$coef[2,"Estimate"]), Std_Error= c(summary(GC.LMM1)$coef[2, "Std. Error"], summary(GC.LMM2)$coef[2, "Std. Error"], summary(GC.LMM3)$coef[2, "Std. Error"], summary(GC.LMM4)$coef[2, "Std. Error"],summary(NEO.TL.LMM1)$coef[2,"Std. Error"], summary(NEO.TL.LMM2)$coef[2,"Std. Error"], summary(NEO.TL.LMM3)$coef[2,"Std. Error"], summary(NEO.TL.LMM4)$coef[2,"Std. Error"], summary(NEO.Con.LMM1)$coef[2,"Std. Error"], summary(NEO.Con.LMM2)$coef[2,"Std. Error"], summary(NEO.Con.LMM3)$coef[2,"Std. Error"], summary(NEO.Con.LMM4)$coef[2,"Std. Error"]), t_value= c(summary(GC.LMM1)$coef[2, "t value"], summary(GC.LMM2)$coef[2, "t value"], summary(GC.LMM3)$coef[2, "t value"], summary(GC.LMM4)$coef[2, "t value"], summary(NEO.TL.LMM1)$coef[2,"t value"], summary(NEO.TL.LMM2)$coef[2,"t value"], summary(NEO.TL.LMM3)$coef[2,"t value"], summary(NEO.TL.LMM4)$coef[2,"t value"], summary(NEO.Con.LMM1)$coef[2,"t value"], summary(NEO.Con.LMM2)$coef[2,"t value"], summary(NEO.Con.LMM3)$coef[2,"t value"], summary(NEO.Con.LMM4)$coef[2,"t value"]), Walds_Chi_square= c(AnovaGC.LMM1[2,1], AnovaGC.LMM2[2,1], AnovaGC.LMM3[2,1], AnovaGC.LMM4[2,1], AnovaNEO.TL.LMM1[2,1], AnovaNEO.TL.LMM2[2,1], AnovaNEO.TL.LMM3[2,1], AnovaNEO.TL.LMM4[2,1], AnovaNEO.Con.LMM1[2,1], AnovaNEO.Con.LMM2[2,1], AnovaNEO.Con.LMM3[2,1], AnovaNEO.Con.LMM4[2,1]), P_value = c(GCcorSoc[1], GCcorSoc[2], GCcorSoc[3], GCcorSoc[4], TLNEOcorSoc[1], TLNEOcorSoc[2], TLNEOcorSoc[3], TLNEOcorSoc[4], ConNEOcorSoc[1], ConNEOcorSoc[2], ConNEOcorSoc[3], ConNEOcorSoc[4]))
```


```{r echo=FALSE}
Obj1.Summary.Kable <- Obj1.Summary %>%
  mutate_if(is.numeric, round, 3) %>%
  mutate(P_value = cell_spec(P_value, "html", bold = ifelse(P_value > 0.05, FALSE, TRUE), color= ifelse(P_value > 0.05, "gray", "black"))) %>%
  rename("P-value**" = P_value, "Wald's χ2" = Walds_Chi_square, "t-value" = t_value, "Std. Error"= Std_Error, "Fixed Effect*"= Fixed_Effect, "Response Variable"= Response_variable) %>%
  kable(format="html", escape = F) %>%
  kable_styling("striped", full_width=TRUE) %>%
  pack_rows(index = c("Objective 1.1" = 4, "Objective 1.2" = 8)) %>%
  footnote(general = "* All models include male rank and latency to sample collection as covariates \n ** FDR adjusted p-value",
           general_title = "") %>%
  save_kable("Table2.pdf") 

#Save as width 900 height 570
```

### Obj 2 table
```{r echo=FALSE}
Obj2.Summary <-data.frame(Response_variable = c("fGC (n=163)", "", "Time-lagged uNEO (n=213)", "", "Concurrent uNEO (n=267)", ""), Fixed_Effect = c("Copulation", "Consort", "Copulation", "Consort", "Copulation", "Consort"), "Estimate" = c(summary(GC.LMM5)$coef[2,"Estimate"], summary(GC.LMM6)$coef[2,"Estimate"],  summary(NEO.TL.LMM5)$coef[2,"Estimate"], summary(NEO.TL.LMM6)$coef[2,"Estimate"],  summary(NEO.Con.LMM5)$coef[2,"Estimate"], summary(NEO.Con.LMM6)$coef[2,"Estimate"]), Std_Error= c(summary(GC.LMM5)$coef[2, "Std. Error"], summary(GC.LMM6)$coef[2, "Std. Error"], summary(NEO.TL.LMM5)$coef[2,"Std. Error"], summary(NEO.TL.LMM6)$coef[2,"Std. Error"], summary(NEO.Con.LMM5)$coef[2,"Std. Error"], summary(NEO.Con.LMM6)$coef[2,"Std. Error"]), t_value= c(summary(GC.LMM5)$coef[2, "t value"], summary(GC.LMM6)$coef[2, "t value"], summary(NEO.TL.LMM5)$coef[2,"t value"], summary(NEO.TL.LMM6)$coef[2,"t value"], summary(NEO.Con.LMM5)$coef[2,"t value"], summary(NEO.Con.LMM6)$coef[2,"t value"]), Walds_Chi_square= c(AnovaGC.LMM5[2,1], AnovaGC.LMM6[2,1], AnovaNEO.TL.LMM5[2,1], AnovaNEO.TL.LMM6[2,1], AnovaNEO.Con.LMM5[2,1], AnovaNEO.Con.LMM6[2,1]), P_value = c(GCcorSex[1], GCcorSex[2], TLNEOcorSex[1], TLNEOcorSex[2], ConNEOcorSex[1], ConNEOcorSex[2]))

Obj2.Summary.Kable <- Obj2.Summary %>%  
  mutate_if(is.numeric, round, 3) %>%
  mutate(P_value = cell_spec(P_value, "html", bold = ifelse(P_value > 0.05, FALSE, TRUE), color= ifelse(P_value > 0.05, "gray", "black"))) %>%
  rename("P-value**" = P_value, "Wald's χ2" = Walds_Chi_square, "t-value" = t_value, "Std. Error"= Std_Error, "Fixed Effect*"= Fixed_Effect, "Response Variable"= Response_variable) %>%
  kable(format="html", escape = F) %>%
  kable_styling("striped", full_width=TRUE) %>%
  pack_rows(index = c("Objective 2.1" = 2, "Objective 2.2" = 4)) %>%
  footnote(general = "* All models include male rank and latency to sample collection as covariates \n ** FDR adjusted p-value",
           general_title = "") %>%
  save_kable("Table3.pdf")

#Save as width 900, height 350
```

### Obj 3 table
```{r echo=FALSE}
Obj3.Summary <-data.frame(Response_variable = c("fGC (n=195)", "uNEO (n=324)", "uNEO without January data (n=300)"), Fixed_Effect = c("Month", "Month", "Month"), "Estimate" = c(summary(GCmod)$coef[2,"Estimate"], summary(NEOmod)$coef[2,"Estimate"],  summary(NEOnoJanmod)$coef[2,"Estimate"]), Std_Error= c(summary(GCmod)$coef[2, "Std. Error"], summary(NEOmod)$coef[2, "Std. Error"], summary(NEOnoJanmod)$coef[2,"Std. Error"]), t_value= c(summary(GCmod)$coef[2, "t value"], summary(NEOmod)$coef[2, "t value"], summary(NEOnoJanmod)$coef[2,"t value"]), Walds_Chi_square= c(AnovaGC.Month[2,1], AnovaNEO.Month[2,1], AnovaNEO.MonthNOJAN[2,1]), P_value = c(round(MonthModsCor[1], digits= 3), "<0.001", "<0.001"))
```


```{r echo=FALSE}
Obj3.Summary.Kable <- Obj3.Summary %>%  
  mutate_if(is.numeric, round, 3) %>%
  mutate(P_value = cell_spec(P_value, "html", bold = ifelse(P_value > 0.05, FALSE, TRUE), color= ifelse(P_value > 0.05, "gray", "black"))) %>%
  rename("P-value**" = P_value, "Wald's χ2" = Walds_Chi_square, "t-value" = t_value, "Std. Error"= Std_Error, "Fixed Effect*"= Fixed_Effect, "Response Variable"= Response_variable) %>%
  kable(format="html", escape = F) %>%
  kable_styling("striped", full_width=TRUE) %>%
  pack_rows(index = c("Objective 3.1" = 1, "Objective 3.2" = 1)) %>%
  footnote(general = "* All models include male rank as a covariate \n ** FDR adjusted p-value",
           general_title = "") %>%
  save_kable("Table4.pdf")
```


## FIGURES

### read in data:
```{r}
GC_Behavior<-read.csv("~/Google Drive/Projects/Masters/R input sheets/GC_behavior_matched.csv", h=T)
TL_NEO<-read.csv("~/Google Drive/Projects/Masters/R input sheets/Time-lagged_NEO.csv", h=T)

Concurrent_NEO<-read.csv("~/Google Drive/Projects/Masters/R input sheets/Concurrent_NEO.csv", h=T)

Concurrent_NEO <- Concurrent_NEO %>%
  mutate(DateDiffCentered = DateDiff)

```

# Fig. 1 Objective 1: Concurrent results
```{r echo=FALSE, warning=FALSE, results='hide', message=FALSE, fig.show='hide'}

set_theme(base= theme_classic(base_size= 6.5))

NEO.Con.LMM2=lmer(log(NEO.CR)~ FreqTotalGR + RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=Concurrent_NEO)
ef <- effect("FreqTotalGR", NEO.Con.LMM2, xlevels=list(FreqTotalGR=Concurrent_NEO$FreqTotalGR))
x <- as.data.frame(ef)
NEOCONtotalGr.plot <- ggplot(x, aes(FreqTotalGR, fit)) + 
  geom_line()  + 
  geom_point(size=0.8) +
  geom_errorbar(aes(ymin=fit-se,
                    ymax=fit+se), width=0.001, color="gray", alpha=0.2) +
  scale_y_continuous(n.breaks=4) +
  labs(y=expression(paste("Concurrent uNEO (ng/mg CR)"^"\u2020")), 
       x="Total Grooming Rate") +
  theme(axis.title = element_text(size=6.5, color="black"),
        axis.title.y = element_text(size = 8))

NEO.Con.LMM2.Ests<-plot_model(NEO.Con.LMM2, show.values=TRUE, value.size=3, dot.size = 0.8, line.size = 0.4, colors=c("gray44", "black"), title="", rm.terms= c("DateDiffCentered", "I(DateDiffCentered^2)"), p.adjust= "fdr", vline.color= "black", axis.labels=c("Rank", "Total\n Grooming")) 


NEO.Con.Total.Gr.plots <- ggarrange(NEOCONtotalGr.plot, NEO.Con.LMM2.Ests, labels= c("(a)", "(b)"), font.label = list(size = 8)) + 
    annotation_custom(grid.rect(.5,.5, width=unit(1,"npc"), height=unit(1,"npc"), gp=gpar(lwd=1, fill=NA, col="black"), draw=TRUE))

NEO.Con.LMM3=lmer(log(NEO.CR)~ FreqGRRec + RelRank + DateDiffCentered + I(DateDiffCentered ^ 2) + (1|ID) +(1|Behav_Date), data=Concurrent_NEO)
ef <- effect("FreqGRRec", NEO.Con.LMM3, xlevels=list(FreqGRRec=Concurrent_NEO$FreqGRRec))
x <- as.data.frame(ef)

NEOCONGrRec.plot <- ggplot(data=x, aes(x=FreqGRRec, y=fit)) + 
  geom_line()  + 
  geom_point(size=0.8) +
  geom_errorbar(aes(ymin=fit-se,
                    ymax=fit+se), width=0.001, colour="gray", alpha=0.2) +
  scale_y_continuous(n.breaks=4, labels=c(5.2,5.4, 5.6, "")) +
  labs(y=expression(paste("Concurrent uNEO (ng/mg CR)"^"\u2020")), x="Receiving Grooming Rate") +
  theme(axis.title = element_text(size=6.5, color="black"),
        axis.title.y = element_text(size = 8))

NEO.Con.LMM3.Ests<-plot_model(NEO.Con.LMM3, show.values=TRUE, value.size=3, dot.size = 0.8, line.size = 0.5, colors=c("gray44", "black"), p.adjust= "fdr", vline.color= "black", rm.terms= c("DateDiffCentered", "I(DateDiffCentered^2)"), title="", axis.labels=c("Rank", "Receiving\n Grooming")) 


NEO.Con.Gr.Rec.plots <- ggarrange(NEOCONGrRec.plot, NEO.Con.LMM3.Ests, labels= c("(c)", "(d)"), font.label = list(size = 8)) + 
    annotation_custom(grid.rect(.5,.5, width=unit(1,"npc"), height=unit(1,"npc"), gp=gpar(lwd=1, fill=NA, col="black"), draw=TRUE)) 

Fig1.Obj1.2<- ggarrange(NEO.Con.Total.Gr.plots, NEO.Con.Gr.Rec.plots, nrow=2, ncol=1)

Fig1.Obj1.2 <- annotate_figure(Fig1.Obj1.2, bottom = text_grob(expression(paste("* p< 0.05; ** p<0.01; *** p<0.001 ", "\u2020", " log transformed")), hjust = 3.65, x = 1, face = "italic", size = 6)); Fig1.Obj1.2

ggsave("~/Google Drive/Projects/Masters/rhesus-sociality-fGC-uNEO/Fig1.pdf", Fig1.Obj1.2, width= 174, height= 120, units= "mm", device=cairo_pdf)
```

```{r echo=FALSE}
Fig1.Obj1.2
```

### Fig2. Objective 2 
```{r echo=FALSE, warning=FALSE, message=FALSE, results='hide', fig.show='hide'}
NEO.Con.LMM5=lmer(log(NEO.CR)~ FreqTimeSpentCop + RelRank + DateDiffCentered + I(DateDiffCentered^2) + (1|ID) +(1|Behav_Date), data=Concurrent_NEO)
ef <- effect("FreqTimeSpentCop", NEO.Con.LMM5, xlevels=list(FreqTimeSpentCop=Concurrent_NEO$FreqTimeSpentCop))
x <- as.data.frame(ef)
NEOCONFreqCop.plot <- ggplot(data=x, aes(x=FreqTimeSpentCop, y=fit)) + 
  geom_line()  + 
  geom_point(size=1) +
  geom_errorbar(aes(ymin=fit-se,
                    ymax=fit+se), width=0.0001, colour="gray", alpha=0.2) +
  scale_x_continuous(limits=c(0.0,0.08)) +
  labs(y=expression(paste("Concurrent uNEO (ng/mg CR)"^"\u2020")), x="Proportion of Time Spent Copulating") +
  theme(axis.title = element_text(size=6.5, color="black"),
        axis.title.y= element_text(size=8))


NEO.Con.LMM5.Ests<-plot_model(NEO.Con.LMM5, show.values=TRUE, title="", colors=c("black", "gray44"), rm.terms= c("DateDiffCentered", "I(DateDiffCentered^2)"), axis.labels=c("Rank", "Copulation"), dot.size = 1, vline.color= "black", p.adjust= "fdr", line.size = 0.5, group.terms=c(1,2))


Fig2.Obj2 <- ggarrange(NEOCONFreqCop.plot, NEO.Con.LMM5.Ests, labels= c("(a)", "(b)"), font.label = list(size = 11)) +
  annotation_custom(grid.rect(.5,.5, width=unit(1,"npc"), height=unit(1,"npc"), gp=gpar(lwd=1, fill=NA, col="black"), draw=TRUE))

Fig2.Obj2 <- annotate_figure(Fig2.Obj2, bottom = text_grob(expression(paste("* p< 0.05; ** p<0.01; *** p<0.001 ", "\u2020", " log transformed")), hjust = 2.72, x = 1, face = "italic", size = 8)); Fig2.Obj2

ggsave("~/Google Drive/Projects/Masters/rhesus-sociality-fGC-uNEO/Fig2.pdf", Fig2.Obj2, width= 174, height= 100, units= "mm", device=cairo_pdf)

```

```{r echo=FALSE}
Fig2.Obj2
```

### Fig3. Objective 3

```{r}
NEOmod <- lmer(log(NEO.CR) ~ Month  + RelRank + (1 |Focal.ID), data= NEO)
ef <- effect("Month", NEOmod, xlevels=list(Month=NEO$Month))
x <- as.data.frame(ef)
NEOMonth.plot <- ggplot(data=x, aes(x=Month, y=fit)) + 
  geom_line()  + 
  geom_point(size=1) +
  geom_errorbar(aes(ymin=fit-se,
                    ymax=fit+se), width=0.0001, colour="gray", alpha=0.2) +
  scale_x_continuous(limits=c(1,4)) +
  labs(y=expression(paste("uNEO (ng/mg CR)"^"\u2020")), x="Month") +
  theme(axis.title = element_text(size=6.5, color="black"),
        axis.title.y= element_text(size=8))


NEOMonth.Ests<-plot_model(NEOmod, show.values=TRUE, title="", colors=c("black", "gray44"), axis.labels=c("Rank", "Month"), dot.size = 1, vline.color= "black", p.adjust="fdr", line.size = 0.5, group.terms=c(1,2)) 


Fig3.Obj3 <- ggarrange(NEOMonth.plot, NEOMonth.Ests, labels= c("(a)", "(b)"), font.label = list(size = 11)) +
  annotation_custom(grid.rect(.5,.5, width=unit(1,"npc"), height=unit(1,"npc"), gp=gpar(lwd=3, fill=NA, col="black"), draw=TRUE))

Fig3.Obj3 <- annotate_figure(Fig3.Obj3, bottom = text_grob(expression(paste("* p< 0.05; ** p<0.01; *** p<0.001 ", "\u2020", " log transformed")), hjust = 2.7, x = 1, face = "italic", size = 8)); Fig4.Obj3

ggsave("~/Google Drive/Projects/Masters/rhesus-sociality-fGC-uNEO/Fig3.pdf", Fig3.Obj3, width= 174, height= 100, units= "mm", device=cairo_pdf)
```


```{r echo=FALSE}
Fig3.Obj3
```



